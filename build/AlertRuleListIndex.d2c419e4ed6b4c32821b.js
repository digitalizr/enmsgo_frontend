"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{7521:(V,P,t)=>{t.d(P,{A:()=>g});var e=t(32196),a=t(96540),l=t(13544),r=t(14578),d=t(55852),i=t(76442);const E=(0,e.css)({textAlign:"center"}),h=(0,e.css)({maxWidth:"700px",margin:"0 auto"}),g=({title:m,buttonIcon:R,buttonLink:p,buttonTitle:f,buttonDisabled:N,onClick:U,proTip:M,proTipLink:W,proTipLinkTitle:b,proTipTarget:A,infoBox:z,infoBoxTitle:ee})=>{const te=()=>a.createElement(a.Fragment,null,M?a.createElement("span",{key:"proTipFooter"},a.createElement(r.I,{name:"rocket"}),a.createElement(a.Fragment,null," ProTip: ",M," "),W&&a.createElement("a",{href:W,target:A,className:"text-link"},b)):"",z?a.createElement("div",{key:"infoBoxHtml",className:`grafana-info-box ${h}`},ee&&a.createElement("h5",null,ee),a.createElement("div",{dangerouslySetInnerHTML:z})):""),O=te()?"":(0,e.css)({marginBottom:"20px"}),B=p?d.z9:d.$n,S=a.createElement(B,{size:"lg",onClick:U,href:p,icon:R,className:O,"data-testid":l.Tp.components.CallToActionCard.buttonV2(f),disabled:N},f);return a.createElement(i.c,{className:E,message:m,footer:te(),callToActionElement:S})}},40715:(V,P,t)=>{t.d(P,{o:()=>r});var e=t(96540),a=t(31678),l=t(97007);function r(d){const i=(0,a.useDispatch)(),E=(0,e.useRef)(d);E.current=d,(0,e.useEffect)(()=>()=>{i((0,l.N)({cleanupAction:E.current}))},[i])}},76543:(V,P,t)=>{t.r(P),t.d(P,{default:()=>It});var e=t(96540),a=t(32264),l=t(32196),r=t(24180),d=t(41053),i=t(10940),E=t(76885),h=t(66602),v=t(40845),g=t(55852),m=t(83277),R=t(31678),p=t(25027),f=t(19073),N=t(9518),U=t(14285),M=t(61410),W=t(23770),b=t(55740),A=t(57220),z=t(37959),ee=t(45058),te=t(75648),O=t(67381),B=t(64853),S=t(55127),H=t.n(S),oe=t(94753),J=t(39558),ce=t(62930),K=t(19384),$=t(15054),Q=t(98439),Ce=t(22620),ye=t(88467),et=t(13544),_e=t(67061),ae=t(14578),He=t(56034),je=t(39938),tt=t(96374),L=t(11167),X=t(83903),Se=t(41520),Le=t(56361),pe=t(23662),F=t(64047),Ue=t(82437),Re=t(79938),xe=t(16293),ie=t(76648),Me=t(84029);function Be({folder:n,onClose:s}){const[o,u]=(0,e.useState)("yaml");return e.createElement(ie.m,{title:`Export ${n.title} rules`,activeTab:o,onTabChange:u,onClose:s,formatProviders:Object.values(Me.sl)},e.createElement(Ve,{folder:n,exportFormat:o,onClose:s}))}function Ve({folder:n,exportFormat:s,onClose:o}){const{currentData:u="",isFetching:c}=Re.hK.endpoints.exportRules.useQuery({folderUid:n.uid,format:s});if(c)return e.createElement(J._,{text:"Loading...."});const D=`${n.title}-${n.uid}`;return e.createElement(xe.J,{format:s,textDefinition:u,downloadFileName:D,onClose:o})}function Ye({folderUid:n,groupName:s,onClose:o}){const[u,c]=(0,e.useState)("yaml");return e.createElement(ie.m,{title:`Export ${s} rules`,activeTab:u,onTabChange:c,onClose:o,formatProviders:Object.values(Me.sl)},e.createElement(We,{folderUid:n,groupName:s,exportFormat:u,onClose:o}))}function We({folderUid:n,groupName:s,exportFormat:o,onClose:u}){const{currentData:c="",isFetching:D}=Re.hK.endpoints.exportRules.useQuery({folderUid:n,group:s,format:o});return D?e.createElement(J._,{text:"Loading...."}):e.createElement(xe.J,{format:o,textDefinition:c,downloadFileName:s,onClose:u})}var Fe=t(99106),ue=t(72275),Ne=t(46479),Je=t(46942),G=t.n(Je),ne=t(2543),ve=t(75494),ge=t(37390),Z=t(99140),w=t(18461),Ke=t(30423);const Qe=n=>{const{group:s,namespace:o,onClose:u,folderUid:c}=n,_=(0,N.dy)().find(y=>y.rulesSource===o.rulesSource&&y.name===o.name)?.groups.find(y=>y.name===s.name),[le,de]=(0,e.useState)(!1),[q,Oe]=(0,e.useState)(_?.rules||[]),re=(0,v.of)(I),he=(0,e.useCallback)(y=>{if(!y.destination||y.destination.index===y.source.index)return;const j=Ge(q,y.source.index,y.destination.index);Oe(j);const Pe=(0,A.EV)(o.rulesSource),Te=(0,ne.compact)(j.map(Ie=>Ie.rulerRule));de(!0),(0,Z.JD)((0,W.DN)({namespaceName:o.name,groupName:s.name,rulesSourceName:Pe,newRules:Te,folderUid:c||o.name})).unwrap().finally(()=>{de(!1)})},[s.name,o.name,o.rulesSource,q,c]),se=q.map(y=>({...y,uid:String((0,w.Ns)(y.rulerRule))}));return e.createElement(ge.a,{className:re.modal,isOpen:!0,title:e.createElement(Xe,{namespace:o,group:s}),onDismiss:u,onClickBackdrop:u},e.createElement(ve.JY,{onDragEnd:he},e.createElement(ve.gL,{droppableId:"alert-list",mode:"standard",renderClone:(y,x,j)=>e.createElement($e,{provided:y,rule:se[j.source.index],isClone:!0})},y=>e.createElement("div",{ref:y.innerRef,className:G()(re.listContainer,le&&re.disabled),...y.droppableProps},se.map((x,j)=>e.createElement(ve.sx,{key:x.uid,draggableId:x.uid,index:j,isDragDisabled:le},Pe=>e.createElement($e,{key:x.uid,provided:Pe,rule:x}))),y.placeholder))))},$e=({provided:n,rule:s,isClone:o=!1,isDragging:u=!1})=>{const c=(0,v.of)(I);return e.createElement("div",{"data-testid":"reorder-alert-rule",className:G()(c.listItem,o&&"isClone",u&&"isDragging"),ref:n.innerRef,...n.draggableProps,...n.dragHandleProps},(0,pe.Z8)(s.promRule)&&e.createElement(Ke.C,{state:s.promRule.state}),(0,pe.KB)(s.promRule)&&e.createElement(je.E,{text:"Recording",color:"blue"}),e.createElement("div",{className:c.listItemName},s.name),e.createElement(ae.I,{name:"draggabledots"}))},Xe=({namespace:n,group:s})=>{const o=(0,v.of)(I);return e.createElement("div",{className:o.header},e.createElement(ae.I,{name:"folder"}),(0,A.Eb)(n.rulesSource)&&e.createElement(He.m,{content:n.rulesSource.name,placement:"top"},e.createElement("img",{alt:n.rulesSource.meta.name,className:o.dataSourceIcon,src:n.rulesSource.meta.info.logos.small})),e.createElement("span",null,n.name),e.createElement(ae.I,{name:"angle-right"}),e.createElement("span",null,s.name))},I=n=>({modal:(0,l.css)({maxWidth:"640px",maxHeight:"80%",overflow:"hidden"}),listItem:(0,l.css)({display:"flex",flexDirection:"row",alignItems:"center",gap:n.spacing(),background:n.colors.background.primary,color:n.colors.text.secondary,borderBottom:`solid 1px ${n.colors.border.medium}`,padding:`${n.spacing(1)} ${n.spacing(2)}`,"&:last-child":{borderBottom:"none"},"&.isClone":{border:`solid 1px ${n.colors.primary.shade}`}}),listContainer:(0,l.css)({userSelect:"none",border:`solid 1px ${n.colors.border.medium}`}),disabled:(0,l.css)({opacity:"0.5",pointerEvents:"none"}),listItemName:(0,l.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),header:(0,l.css)({display:"flex",alignItems:"center",gap:n.spacing(1)}),dataSourceIcon:(0,l.css)({width:n.spacing(2),height:n.spacing(2)})});function Ge(n,s,o){const u=Array.from(n),[c]=u.splice(s,1);return u.splice(o,0,c),u}var be=t(92467),Ae=t(80215);const qe=e.memo(({group:n,namespace:s,expandAll:o,viewMode:u})=>{const{rulesSource:c}=s,D=(0,R.useDispatch)(),C=(0,v.of)(k),[_,le]=(0,e.useState)(!1),[de,q]=(0,e.useState)(!1),[Oe,re]=(0,e.useState)(!1),[he,se]=(0,e.useState)(void 0),[y,x]=(0,e.useState)(!o),{canEditRules:j}=(0,Se.V)();(0,e.useEffect)(()=>{x(!o)},[o]);const{hasRuler:Pe,rulerRulesLoaded:Te}=(0,X.y)(),Ie=n.rules[0]?.rulerRule,Y=Ie&&(0,pe.lT)(Ie)&&Ie.grafana_alert.namespace_uid||void 0,{folder:Ee}=(0,L.a)(Y),nt=Pe(c)&&Te(c)&&!n.rules.find(De=>!!De.rulerRule),Ze=(0,pe.YN)(n),ze=n.rules.some(De=>(0,pe.lT)(De.rulerRule)&&De.rulerRule.grafana_alert.provenance),we=u==="list",ke=u==="grouped",fe=()=>{D((0,W.g6)(s,n)),q(!1)},T=[];if(nt)T.push(e.createElement(_e.B,{key:"is-deleting"},e.createElement(ce.y,null),"deleting"));else if(c===A.hY){if(Y){const De=(0,Le.NH)(Y);Ee?.canSave&&(ke&&!ze&&(T.push(e.createElement(ue.M,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>le(!0)})),T.push(e.createElement(ue.M,{"data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:C.rotate90,onClick:()=>re(!0)}))),we&&(T.push(e.createElement(ue.M,{"aria-label":"go to folder",key:"goto",icon:"folder-open",tooltip:"go to folder",to:De,target:"__blank"})),Ee?.canAdmin&&T.push(e.createElement(ue.M,{"aria-label":"manage permissions",key:"manage-perms",icon:"lock",tooltip:"manage permissions",to:De+"/permissions",target:"__blank"})))),Ee&&(we?T.push(e.createElement(ue.M,{"aria-label":"export rule folder","data-testid":"export-folder",key:"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>se("folder")})):ke&&T.push(e.createElement(ue.M,{"aria-label":"export rule group","data-testid":"export-group",key:"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>se("group")})))}}else j(c.name)&&Pe(c)&&(Ze||(T.push(e.createElement(ue.M,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>le(!0)})),T.push(e.createElement(ue.M,{"data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:C.rotate90,onClick:()=>re(!0)}))),T.push(e.createElement(ue.M,{"aria-label":"delete rule group","data-testid":"delete-group",key:"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>q(!0)})));const st=we?e.createElement(Ue.c,{namespace:(0,Fe.EL)(s).name}):e.createElement(Ue.c,{namespace:(0,Fe.EL)(s).name,group:n.name}),ot=(De=!1)=>{De||(0,p.fH)(p.le.leavingRuleGroupEdit),le(!1)};return e.createElement("div",{className:C.wrapper,"data-testid":"rule-group"},e.createElement("div",{className:C.header,"data-testid":"rule-group-header"},e.createElement(F.e,{size:"sm",className:C.collapseToggle,isCollapsed:y,onToggle:x,"data-testid":et.Tp.components.AlertRules.groupToggle}),e.createElement(ae.I,{name:y?"folder":"folder-open"}),(0,A.Eb)(c)&&e.createElement(He.m,{content:c.name,placement:"top"},e.createElement("img",{alt:c.meta.name,className:C.dataSourceIcon,src:c.meta.info.logos.small})),e.createElement("div",{className:C.groupName,onClick:()=>x(!y)},Ze&&e.createElement(je.E,{color:"purple",text:"Federated"})," ",st),e.createElement("div",{className:C.spacer}),e.createElement("div",{className:C.headerStats},e.createElement(be.j7,{group:n})),ze&&e.createElement(e.Fragment,null,e.createElement("div",{className:C.actionsSeparator},"|"),e.createElement("div",{className:C.actionIcons},e.createElement(je.E,{color:"purple",text:"Provisioned"}))),!!T.length&&e.createElement(e.Fragment,null,e.createElement("div",{className:C.actionsSeparator},"|"),e.createElement("div",{className:C.actionIcons},e.createElement(_e.B,{gap:.5},T)))),!y&&e.createElement(Ae.s,{showSummaryColumn:!0,className:C.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!n.interval,rules:n.rules}),_&&e.createElement(Ne.u5,{namespace:s,group:n,onClose:()=>ot(),folderUrl:Ee?.canEdit?(0,Le.qN)(Ee.uid):void 0,folderUid:Y}),Oe&&e.createElement(Qe,{group:n,folderUid:Y,namespace:s,onClose:()=>re(!1)}),e.createElement(tt.u,{isOpen:de,title:"Delete group",body:e.createElement("div",null,e.createElement("p",null,'Deleting "',e.createElement("strong",null,n.name),'" will permanently remove the group and'," ",n.rules.length," alert ",H()("rule",n.rules.length)," belonging to it."),e.createElement("p",null,"Are you sure you want to delete this group?")),onConfirm:fe,onDismiss:()=>q(!1),confirmText:"Delete"}),Ee&&he==="folder"&&e.createElement(Be,{folder:Ee,onClose:()=>se(void 0)}),Ee&&he==="group"&&e.createElement(Ye,{folderUid:Ee.uid,groupName:n.name,onClose:()=>se(void 0)}))});qe.displayName="RulesGroup";const k=n=>({wrapper:(0,l.css)({}),header:(0,l.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${n.spacing(1)} ${n.spacing(1)} ${n.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${n.colors.border.weak}`,"&:hover":{backgroundColor:n.components.table.rowHoverBackground}}),headerStats:(0,l.css)({flexShrink:0,span:{verticalAlign:"middle"},[n.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:n.spacing(1)}}),groupName:(0,l.css)({marginLeft:n.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,l.css)({flex:1}),collapseToggle:(0,l.css)({background:"none",border:"none",marginTop:`-${n.spacing(1)}`,marginBottom:`-${n.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,l.css)({width:n.spacing(2),height:n.spacing(2),marginLeft:n.spacing(2)}),dataSourceOrigin:(0,l.css)({marginRight:"1em",color:n.colors.text.disabled}),actionsSeparator:(0,l.css)({margin:`0 ${n.spacing(2)}`}),actionIcons:(0,l.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,l.css)({margin:n.spacing(2,0)}),rotate90:(0,l.css)({transform:"rotate(90deg)"})});function lt(n){return(0,e.useMemo)(()=>n.flatMap(s=>s.groups.map(o=>({namespace:s,group:o}))),[n])}const ct=({namespaces:n,expandAll:s})=>{const o=(0,v.of)(it),u=(0,M.$)(x=>x.dataSources),c=(0,M.$)(x=>x.promRules),D=(0,e.useMemo)(A.qi,[]),C=lt(n),_=(0,e.useMemo)(()=>D.filter(x=>(0,ye.ML)(c[x.name])||(0,ye.ML)(u[x.name])),[c,u,D]),le=D.some(x=>!!c[x.name]?.result?.length),de=D.length>0,q=_.length>0,Oe=n.length>0,{numberOfPages:re,onPageChange:he,page:se,pageItems:y}=(0,Q.W)(C,1,$.FG);return e.createElement("section",{className:o.wrapper},e.createElement("div",{className:o.sectionHeader},e.createElement("div",{className:o.headerRow},e.createElement(oe.E,{element:"h2",variant:"h5"},"Mimir / Cortex / Loki"),_.length?e.createElement(J._,{className:o.loader,text:`Loading rules from ${_.length} ${H()("source",_.length)}`}):e.createElement("div",null),e.createElement(ut,null))),y.map(({group:x,namespace:j})=>e.createElement(qe,{group:x,key:`${(0,A.v0)(j.rulesSource)}-${j.name}-${x.name}`,namespace:j,expandAll:s,viewMode:"grouped"})),!de&&e.createElement("p",null,"There are no Prometheus or Loki data sources configured."),de&&!q&&!Oe&&e.createElement("p",null,"No rules found."),!le&&q&&e.createElement(ce.y,{size:"xl",className:o.spinner}),e.createElement(K.d,{className:o.pagination,currentPage:se,numberOfPages:re,onNavigate:he,hideWhenSinglePage:!0}))},it=n=>({loader:(0,l.css)({marginBottom:0}),sectionHeader:(0,l.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,l.css)({marginBottom:n.spacing(4)}),spinner:(0,l.css)({textAlign:"center",padding:n.spacing(2)}),pagination:(0,Ce.H)(n),headerRow:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:n.spacing(1)})});function ut(){const[n,s]=(0,f.Ej)(f.RY.CreateExternalAlertRule),o=(0,r.zy)();return n&&s?e.createElement(g.z9,{key:"new-recording-rule",href:E.kM.renderUrl("alerting/new/recording",{returnTo:o.pathname+o.search}),icon:"plus",variant:"secondary"},"New recording rule"):null}var mt=t(42941);function dt({onClose:n}){const[s,o]=(0,e.useState)("yaml");return e.createElement(ie.m,{activeTab:s,onTabChange:o,onClose:n,formatProviders:Object.values(Me.sl)},e.createElement(Et,{exportFormat:s,onClose:n}))}function Et({exportFormat:n,onClose:s}){const{currentData:o="",isFetching:u}=Re.hK.endpoints.exportRules.useQuery({format:n}),c=`alert-rules-${new Date().getTime()}`;return u?e.createElement(J._,{text:"Loading...."}):e.createElement(xe.J,{format:n,textDefinition:o,downloadFileName:c,onClose:s})}const gt=({namespaces:n,expandAll:s})=>{const o=(0,v.of)(ft),[u]=(0,m.s)(),{prom:c,ruler:D}=(0,M.$)(Y=>({prom:Y.promRules[A.hY]||ye.jA,ruler:Y.rulerRules[A.hY]||ye.jA})),C=c.loading||D.loading,_=!!c.result||!!D.result,le=u.view==="list",de=le?(0,N.Jr)(n):n,q=lt(de),{numberOfPages:Oe,onPageChange:re,page:he,pageItems:se}=(0,Q.W)(q,1,$.FG),[y,x]=(0,f.Ej)(f.RY.ExportGrafanaManagedRules),j=y&&x,[Pe,Te]=(0,mt.A)(!1),Ie=n.length>0;return e.createElement("section",{className:o.wrapper},e.createElement("div",{className:o.sectionHeader},e.createElement("div",{className:o.headerRow},e.createElement(oe.E,{element:"h2",variant:"h5"},"Grafana"),C?e.createElement(J._,{className:o.loader,text:"Loading..."}):e.createElement("div",null),Ie&&j&&e.createElement(g.$n,{"aria-label":"export all grafana rules","data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:"Export all Grafana-managed rules",onClick:Te,variant:"secondary"},"Export rules"))),se.map(({group:Y,namespace:Ee})=>e.createElement(qe,{group:Y,key:`${Ee.name}-${Y.name}`,namespace:Ee,expandAll:s,viewMode:le?"list":"grouped"})),_&&de?.length===0&&e.createElement("p",null,"No rules found."),!_&&C&&e.createElement(ce.y,{size:"xl",className:o.spinner}),e.createElement(K.d,{className:o.pagination,currentPage:he,numberOfPages:Oe,onNavigate:re,hideWhenSinglePage:!0}),j&&Pe&&e.createElement(dt,{onClose:Te}))},ft=n=>({loader:(0,l.css)({marginBottom:0}),sectionHeader:(0,l.css)({display:"flex",justifyContent:"space-between",marginBottom:n.spacing(1)}),wrapper:(0,l.css)({marginBottom:n.spacing(4)}),spinner:(0,l.css)({textAlign:"center",padding:n.spacing(2)}),pagination:(0,Ce.H)(n),headerRow:(0,l.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),pt=({namespaces:n,expandAll:s})=>{const[o,u]=(0,e.useMemo)(()=>{const c=n.map(D=>({...D,groups:D.groups.sort((C,_)=>C.name.localeCompare(_.name))})).sort((D,C)=>D.name.localeCompare(C.name));return[c.filter(D=>(0,A.z2)(D.rulesSource)),c.filter(D=>(0,A.Eb)(D.rulesSource))]},[n]);return(0,e.useEffect)(()=>{(0,p.fH)(p.le.loadedList)},[]),e.createElement(e.Fragment,null,e.createElement(B._,{actions:[f.RY.ViewAlertRule]},e.createElement(gt,{namespaces:o,expandAll:s})),e.createElement(B._,{actions:[f.RY.ViewExternalAlertRule]},e.createElement(ct,{namespaces:u,expandAll:s})))};var me=t(94822);const at=({rules:n,state:s,defaultCollapsed:o=!1})=>{const[u,c]=(0,e.useState)(o),D=(0,v.of)(vt);return e.createElement(e.Fragment,null,e.createElement("h4",{className:D.header},e.createElement(F.e,{className:D.collapseToggle,size:"xxl",isCollapsed:u,onToggle:()=>c(!u)}),(0,pe.XI)(s)," (",n.length,")"),!u&&e.createElement(Ae.s,{className:D.rulesTable,rules:n,showGroupColumn:!0}))},vt=n=>({collapseToggle:(0,l.css)({verticalAlign:"middle"}),header:(0,l.css)({marginTop:n.spacing(2)}),rulesTable:(0,l.css)({marginTop:n.spacing(3)})}),ht=({namespaces:n})=>{const s=(0,Le.Ht)((0,m.s)()[0]),o=(0,e.useMemo)(()=>{const u={[me.cF.Firing]:[],[me.cF.Inactive]:[],[me.cF.Pending]:[]};return n.forEach(c=>c.groups.forEach(D=>D.rules.forEach(C=>{C.promRule&&(0,pe.Z8)(C.promRule)&&u[C.promRule.state].push(C)}))),Object.values(u).forEach(c=>c.sort((D,C)=>D.name.localeCompare(C.name))),u},[n]);return e.createElement(e.Fragment,null,(!s.alertState||s.alertState===me.cF.Firing)&&e.createElement(at,{state:me.cF.Firing,rules:o[me.cF.Firing]}),(!s.alertState||s.alertState===me.cF.Pending)&&e.createElement(at,{state:me.cF.Pending,rules:o[me.cF.Pending]}),(!s.alertState||s.alertState===me.cF.Inactive)&&e.createElement(at,{defaultCollapsed:s.alertState!==me.cF.Inactive,state:me.cF.Inactive,rules:o[me.cF.Inactive]}))};var Rt=t(84866);const rt={groups:pt,state:ht},Pt=te.Ys+1,Dt=(0,h.Xc)(()=>{const n=(0,R.useDispatch)(),s=(0,v.of)(Ct),o=(0,e.useMemo)(A.gR,[]),[u,c]=(0,e.useState)(!1),D=(0,e.useCallback)(()=>c(!1),[]),[C]=(0,m.s)(),{filterState:_,hasActiveFilters:le}=(0,U.dI)(),de=C.view,q=rt[de]?de:"groups",Oe=rt[q],re=(0,M.$)(fe=>fe.promRules),he=(0,M.$)(fe=>fe.rulerRules),se=o.some(fe=>re[fe]?.loading||he[fe]?.loading),y=Object.entries(re),x=Object.entries(he),j=y.every(([fe,T])=>T.dispatched&&(T?.result!==void 0||T?.error!==void 0)),Pe=x.every(([fe,T])=>T.dispatched&&(T?.result!==void 0||T?.error!==void 0)),Te=y.every(([fe,T])=>T.dispatched&&T?.result?.length===0),Ie=x.every(([fe,T])=>Object.entries(T?.result??{}).every(([De,xt])=>xt?.length===0)&&T.dispatched),Y=le?void 0:Pt,[Ee,nt]=(0,d.A)(async()=>{se||await n((0,W.yo)(!1,{limitAlerts:Y}))},[se,Y,n]);(0,e.useEffect)(()=>{(0,p.Sq)().catch(()=>{})},[]),(0,e.useEffect)(()=>{n((0,W.yo)(!1,{limitAlerts:Y}))},[n,Y]),(0,i.A)(nt,b.HH);const Ze=j&&Te&&y.length>0&&Ie&&Pe,ze=!Ze,we=(0,N.dy)(),ke=(0,U.i7)(we,_);return e.createElement(z.d,{navId:"alert-list",isLoading:!1,actions:ze&&e.createElement(Mt,null)},e.createElement(O.o,null),e.createElement(Rt.A,{onFilterCleared:D}),ze&&e.createElement(e.Fragment,null,e.createElement("div",{className:s.break}),e.createElement("div",{className:s.buttonsContainer},e.createElement("div",{className:s.statsContainer},q==="groups"&&le&&e.createElement(g.$n,{className:s.expandAllButton,icon:u?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>c(!u)},u?"Collapse all":"Expand all"),e.createElement(be.M_,{namespaces:ke})))),Ze&&e.createElement(ee.w,null),ze&&e.createElement(Oe,{expandAll:u,namespaces:ke}))},{style:"page"}),Ct=n=>({break:(0,l.css)({width:"100%",height:0,marginBottom:n.spacing(2),borderBottom:`solid 1px ${n.colors.border.medium}`}),buttonsContainer:(0,l.css)({marginBottom:n.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,l.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,l.css)({marginRight:n.spacing(1)})}),yt=Dt;function Mt(){const[n,s]=(0,f.Ej)(f.RY.CreateAlertRule),[o,u]=(0,f.Ej)(f.RY.CreateExternalAlertRule),c=(0,r.zy)();return n&&s||o&&u?e.createElement(g.z9,{href:E.kM.renderUrl("alerting/new/alerting",{returnTo:c.pathname+c.search}),icon:"plus",onClick:()=>(0,p.fH)(p.le.alertRuleFromScratch)},"New alert rule"):null}const Ot=e.lazy(()=>t.e(2042).then(t.bind(t,82042))),It=()=>{const n=a.$.featureToggles.alertingListViewV2;return e.createElement(e.Suspense,null,n?e.createElement(Ot,null):e.createElement(yt,null))}},64853:(V,P,t)=>{t.d(P,{_:()=>d});var e=t(2543),a=t.n(e),l=t(96540),r=t(19073);const d=({actions:m,children:R})=>{const p=(0,e.filter)(m,v),f=(0,e.filter)(m,g);return p.length?l.createElement(i,{actions:p},R):f.length?l.createElement(E,{actions:f},R):null},i=({actions:m,children:R})=>{const p=(0,r.iI)();return h(p,m)?l.createElement(l.Fragment,null,R):null},E=({actions:m,children:R})=>{const p=(0,r.e2)();return h(p,m)?l.createElement(l.Fragment,null,R):null};function h(m,R){return(0,e.chain)(m).pick(R).values().value().some(([p,f])=>f===!0)}function v(m){return Object.values(r.QI).includes(m)}function g(m){return Object.values(r.RY).includes(m)}},64047:(V,P,t)=>{t.d(P,{e:()=>l});var e=t(96540),a=t(55852);const l=({isCollapsed:r,onToggle:d,idControlled:i,className:E,text:h,size:v="xl",...g})=>e.createElement(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!r,"aria-controls":i,className:E,icon:r?"angle-right":"angle-down",onClick:()=>d(!r),...g},h)},16293:(V,P,t)=>{t.d(P,{J:()=>p});var e=t(32196),a=t(4213),l=t.n(a),r=t(96540),d=t(70713),i=t(40845),E=t(32372),h=t(55852),v=t(10534),g=t(72109),m=t(42418),R=t(84029);function p({format:U,textDefinition:M,downloadFileName:W,onClose:b}){const A=(0,i.of)(f),z=R.sl[U],ee=(0,r.useCallback)(()=>{const O=new Blob([M],{type:`application/${U};charset=utf-8`});l()(O,`${W}.${U}`)},[M,W,U]),te=(0,r.useMemo)(()=>z.formatter?z.formatter(M):M,[z,M]);return r.createElement("div",{className:A.container},r.createElement(N,{exportProvider:z}),r.createElement("div",{className:A.content},r.createElement(d.Ay,{disableWidth:!0},({height:O})=>r.createElement(E.B,{width:"100%",height:O,language:U,value:te,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}}))),r.createElement("div",{className:A.actions},r.createElement(h.$n,{variant:"secondary",onClick:b},"Cancel"),r.createElement(v.b,{icon:"copy",getText:()=>M},"Copy code"),r.createElement(h.$n,{icon:"download-alt",onClick:ee},"Download")))}const f=U=>({container:(0,e.css)({display:"flex",flexDirection:"column",height:"100%",gap:U.spacing(2)}),content:(0,e.css)({flex:"1 1 100%"}),actions:(0,e.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:U.spacing(1)})});function N({exportProvider:U}){const{name:M,type:W}=U,b={file:{title:"File-provisioning format",component:r.createElement(r.Fragment,null,M," format is only valid for File Provisioning."," ",r.createElement(g.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0},"Read more in the docs."))},api:{title:"API-provisioning format",component:r.createElement(r.Fragment,null,M," format is only valid for API Provisioning."," ",r.createElement(g.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0},"Read more in the docs."))},terraform:{title:"Terraform-provisioning format",component:r.createElement(r.Fragment,null,M," format is only valid for Terraform Provisioning."," ",r.createElement(g.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0},"Read more in the docs."))}},{title:A,component:z}=b[W];return r.createElement(m.F,{title:A,severity:"info",bottomSpacing:0,topSpacing:0},z)}},76648:(V,P,t)=>{t.d(P,{m:()=>r});var e=t(96540),a=t(87978),l=t(73716);function r({activeTab:d,onTabChange:i,children:E,onClose:h,formatProviders:v,title:g="Export"}){const m=Object.values(v).map(R=>({label:R.name,value:R.exportFormat}));return e.createElement(a._,{title:g,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:e.createElement(l.sb,{tabs:m,setActiveTab:i,activeTab:d}),onClose:h,size:"md"},E)}},84029:(V,P,t)=>{t.d(P,{sl:()=>r});const e={name:"JSON",exportFormat:"json",type:"file",formatter:i=>{try{return JSON.stringify(JSON.parse(i),null,4)}catch{return i}}},a={name:"YAML",exportFormat:"yaml",type:"file"},l={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},r={[e.exportFormat]:e,[a.exportFormat]:a,[l.exportFormat]:l},d=[e,a]},64100:(V,P,t)=>{t.d(P,{G:()=>h});var e=t(32196),a=t(96540),l=t(40845),r=t(60782),d=t(67061),i=t(14578),E=t(94753);function h({contentText:g,externalLink:m,linkText:R,title:p="Need help?"}){const f=(0,l.of)(v);return a.createElement(r.G,{content:a.createElement("div",{className:f.mutedText},g),title:a.createElement(d.B,{gap:.5,direction:"row",alignItems:"center"},a.createElement(i.I,{name:"question-circle"}),p),footer:m?a.createElement("a",{href:m,target:"_blank",rel:"noreferrer"},a.createElement(d.B,{direction:"row",gap:.5,alignItems:"center"},a.createElement(E.E,{color:"link"},R," ",a.createElement(i.I,{size:"sm",name:"external-link-alt"})))):void 0,closeButton:!0,placement:"bottom-start"},a.createElement("div",{className:f.helpInfo},a.createElement(d.B,{direction:"row",alignItems:"center",gap:.5},a.createElement(i.I,{name:"question-circle",size:"sm"}),a.createElement(E.E,{variant:"bodySmall",color:"primary"},"Need help?"))))}const v=g=>({mutedText:(0,e.css)({color:g.colors.text.secondary,fontSize:g.typography.size.sm}),helpInfo:(0,e.css)({cursor:"pointer",textDecoration:"underline"})})},271:(V,P,t)=>{t.d(P,{P:()=>E});var e=t(32196),a=t(96540),l=t(40845),r=t(84167),d=t(94753),i=t(67061);const E=({title:v,stepNo:g,children:m,fullWidth:R=!1,description:p})=>{const f=(0,l.of)(h);return a.createElement("div",{className:f.parent},a.createElement(r.n,{className:(0,e.cx)(R&&f.fullWidth),label:a.createElement(d.E,{variant:"h3"},g,". ",v)},a.createElement(i.B,{direction:"column"},p&&a.createElement("div",{className:f.description},p),m)))},h=v=>({parent:(0,e.css)({display:"flex",flexDirection:"row",border:`solid 1px ${v.colors.border.weak}`,borderRadius:v.shape.radius.default,padding:`${v.spacing(2)} ${v.spacing(3)}`}),description:(0,e.css)({marginTop:`-${v.spacing(2)}`}),fullWidth:(0,e.css)({width:"100%"})})},73716:(V,P,t)=>{t.d(P,{G_:()=>M,sb:()=>W});var e=t(32196),a=t(20382),l=t(96540),r=t(49785),d=t(70713),i=t(40845),E=t(87978),h=t(63021),v=t(40675),g=t(55852),m=t(56034),R=t(14578),p=t(32372),f=t(63066),N=t(23662);const U=[{label:"Yaml",value:"yaml"}],M=({onClose:O})=>{const[B,S]=(0,l.useState)("yaml"),{setValue:H}=(0,r.xW)(),oe=(0,i.of)(te),J=ce=>{for(const K in ce)H(K,ce[K]);O()};return l.createElement(E._,{title:"Inspect Alert rule",subtitle:l.createElement("div",{className:oe.subtitle},l.createElement(W,{tabs:U,setActiveTab:S,activeTab:B})),onClose:O},B==="yaml"&&l.createElement(b,{onSubmit:J}))};function W({tabs:O,activeTab:B,setActiveTab:S}){return l.createElement(h.U,null,O.map((H,oe)=>l.createElement(v.o,{key:`${H.value}-${oe}`,label:H.label,value:H.value,onChangeTab:()=>S(H.value),active:B===H.value})))}const b=({onSubmit:O})=>{const B=(0,i.of)(ee),{getValues:S}=(0,r.xW)(),H=(0,f.l1)(S()),[oe,J]=(0,l.useState)((0,a.Bh)(H)),ce=()=>{const K=(0,a.Hh)(oe),$=S(),Q=z(K);O({...$,...Q})};return l.createElement(l.Fragment,null,l.createElement("div",{className:B.applyButton},l.createElement(g.$n,{type:"button",onClick:ce},"Apply"),l.createElement(m.m,{content:l.createElement(A,null),theme:"info",placement:"left-start",interactive:!0},l.createElement(R.I,{name:"exclamation-triangle",size:"xl"}))),l.createElement("div",{className:B.content},l.createElement(d.Ay,{disableWidth:!0},({height:K})=>l.createElement(p.B,{width:"100%",height:K,language:"yaml",value:oe,onBlur:J,monacoOptions:{minimap:{enabled:!1}}}))))};function A(){return l.createElement("div",null,"The YAML content in the editor only contains alert rule configuration ",l.createElement("br",null),"To configure Prometheus, you need to provide the rest of the"," ",l.createElement("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer"},"configuration file content."))}function z(O){return(0,N.$y)(O)?(0,f.Qk)(O):(0,N.i7)(O)?(0,f.XI)(O):{}}const ee=O=>({content:(0,e.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:O.spacing(2)}),applyButton:(0,e.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:O.spacing(2)})}),te=()=>({subtitle:(0,e.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},72275:(V,P,t)=>{t.d(P,{M:()=>r});var e=t(96540),a=t(56034),l=t(55852);const r=({tooltip:d,icon:i,to:E,target:h,onClick:v,className:g,tooltipPlacement:m="top",...R})=>{const p=typeof d=="string"?d:void 0;return e.createElement(a.m,{content:d,placement:m},E?e.createElement(l.z9,{variant:"secondary",fill:"text",icon:i,href:E,size:"sm",target:h,...R,"aria-label":p}):e.createElement(l.$n,{className:g,variant:"secondary",fill:"text",size:"sm",icon:i,type:"button",onClick:v,...R,"aria-label":p}))}},45058:(V,P,t)=>{t.d(P,{w:()=>v});var e=t(32196),a=t(96540),l=t(40845),r=t(67061),d=t(76442),i=t(7521),E=t(25027),h=t(41520);const v=()=>{const{canCreateGrafanaRules:m,canCreateCloudRules:R}=(0,h.V)(),p=(0,l.of)(g);return m||R?a.createElement("div",null,a.createElement("p",null,"You haven't created any alert rules yet"),a.createElement(r.B,{gap:1},a.createElement("div",{className:p.newRuleCard},a.createElement(i.A,{title:"",buttonIcon:"bell",buttonLink:"alerting/new/alerting",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,E.fH)(E.le.alertRuleFromScratch)})),a.createElement("div",{className:p.newRuleCard},a.createElement(i.A,{title:"",buttonIcon:"plus",buttonLink:"alerting/new/recording",buttonTitle:"New recording rule",onClick:()=>(0,E.fH)(E.le.recordingRuleFromScratch)})))):a.createElement(d.c,{message:"No rules exist yet.",callToActionElement:a.createElement("div",null)})},g=m=>({newRuleCard:(0,e.css)({width:`calc(50% - ${m.spacing(1)})`,"> div":{height:"100%"}})})},67381:(V,P,t)=>{t.d(P,{o:()=>f});var e=t(32196),a=t(55127),l=t.n(a),r=t(96540),d=t(78685),i=t(40845),E=t(42418),h=t(55852),v=t(56034),g=t(61410),m=t(57220),R=t(56361),p=t(23662);function f(){const[M,W]=(0,r.useState)(!1),[b,A]=(0,d.A)("grafana.unifiedalerting.hideErrors",!1),z=(0,g.$)(S=>S.dataSources),ee=(0,g.$)(S=>S.promRules),te=(0,g.$)(S=>S.rulerRules),O=(0,i.of)(U),B=(0,r.useMemo)(()=>{const[S,H,oe]=[z,ee,te].map($=>(0,m.qi)().reduce((Q,Ce)=>{const ye=$[Ce.name]?.error;return $[Ce.name]&&ye&&!(0,p.$7)($[Ce.name])?[...Q,{dataSource:Ce,error:ye}]:Q},[])),J=ee[m.hY]?.error,ce=te[m.hY]?.error,K=[];return J&&K.push(r.createElement(r.Fragment,null,"Failed to load Grafana rules state: ",J.message||"Unknown error.")),ce&&K.push(r.createElement(r.Fragment,null,"Failed to load Grafana rules config: ",ce.message||"Unknown error.")),S.forEach(({dataSource:$,error:Q})=>{K.push(r.createElement(r.Fragment,null,"Failed to load the data source configuration for"," ",r.createElement("a",{href:(0,R.GD)($.uid),className:O.dsLink},$.name),": ",Q.message||"Unknown error."))}),H.forEach(({dataSource:$,error:Q})=>K.push(r.createElement(r.Fragment,null,"Failed to load rules state from"," ",r.createElement("a",{href:(0,R.GD)($.uid),className:O.dsLink},$.name),": ",Q.message||"Unknown error."))),oe.forEach(({dataSource:$,error:Q})=>K.push(r.createElement(r.Fragment,null,"Failed to load rules config from"," ",r.createElement("a",{href:(0,R.GD)($.uid),className:O.dsLink},$.name),": ",Q.message||"Unknown error."))),K},[z,ee,te,O.dsLink]);return r.createElement(r.Fragment,null,!!B.length&&b&&r.createElement(N,{count:B.length,onClick:()=>A(S=>!S)}),!!B.length&&!b&&r.createElement(E.F,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>A(!0)},M&&B.map((S,H)=>r.createElement("div",{key:H},S)),!M&&r.createElement(r.Fragment,null,r.createElement("div",null,B[0]),B.length>=2&&r.createElement(h.$n,{className:O.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>W(!0)},B.length-1," more ",l()("error",B.length-1)))))}const N=({count:M,onClick:W})=>{const b=(0,i.of)(U);return r.createElement("div",{className:b.floatRight},r.createElement(v.m,{content:"Show all errors",placement:"bottom"},r.createElement(h.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:W},M>1?r.createElement(r.Fragment,null,M," errors"):r.createElement(r.Fragment,null,"1 error"))))},U=M=>({moreButton:(0,e.css)({padding:0}),floatRight:(0,e.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,e.css)({fontWeight:M.typography.fontWeightBold})})},84866:(V,P,t)=>{t.d(P,{A:()=>tt});var e=t(32196),a=t(96540),l=t(49785),r=t(40845),d=t(14578),i=t(67061),E=t(88575),h=t(60029),v=t(56034),g=t(94354),m=t(10354),R=t(55852),p=t(59429),f=t(94822),N=t(25027),U=t(14285),M=t(39964),W=t(86171),b=t(28475),A=t(23662),z=t(35108),ee=t(22391),te=t(51527),O=t(13544),B=t(19347),S=t(26657),H=t(21594),oe=t(98624),J=t(57220);const ce=L=>{const X=(0,B.l)(),[Se,Le]=(0,a.useState)(),pe=(G,ne)=>{if(ne.action==="clear"&&L.onClear){L.onClear();return}const ve=G[G.length-1];let ge,Z;ne.action==="pop-value"||ne.action==="remove-value"?(ge=ne.removedValue?.value,Z="remove"):(ge=ve.value,Z="add");const w=X.getInstanceSettings(ge);w&&(L.onChange(w,Z),Le({error:void 0}))},F=()=>{const{current:G,hideTextValue:ne,noDefault:ve}=L;if(!(!G&&ve))return G?.map(ge=>{const Z=X.getInstanceSettings(ge);if(Z)return{label:Z.name.slice(0,37),value:Z.name,imgUrl:Z.meta.info.logos.small,hideText:ne,meta:Z.meta};const w=(0,ee.Iz)(ge);return w===S.dR.uid||w===S.dR.name?{label:w,value:w,hideText:ne}:{label:(w??"no name")+" - not found",value:w??void 0,imgUrl:"",hideText:ne}})},Ue=()=>{const{alerting:G,tracing:ne,metrics:ve,mixed:ge,dashboard:Z,variables:w,annotations:Ke,pluginId:Qe,type:$e,filter:Xe,logs:I}=L,Ge=X.getList({alerting:G,tracing:ne,metrics:ve,logs:I,dashboard:Z,mixed:ge,variables:w,annotations:Ke,pluginId:Qe,filter:Xe,type:$e}),be=Ge.filter(J.hP).map(k=>({value:k.name,label:`${k.name}${k.isDefault?" (default)":""}`,imgUrl:k.meta.info.logos.small,meta:k.meta})),Ae=Ge.filter(k=>!(0,J.hP)(k)).map(k=>({value:k.name,label:`${k.name}${k.isDefault?" (default)":""}`,imgUrl:k.meta.info.logos.small,meta:k.meta}));return[{label:"Data sources with configured alert rules",options:be,expanded:!0},{label:"Other data sources",options:Ae,expanded:!0}]},{autoFocus:Re,onBlur:xe,onClear:ie,openMenuOnFocus:Me,placeholder:Be,width:Ve,inputId:Ye,disabled:We=!1,isLoading:Fe=!1}=L,ue=Ue(),Ne=F(),Je=typeof ie=="function";return a.createElement("div",{"data-testid":O.Tp.components.DataSourcePicker.container},a.createElement(H.KF,{isLoading:Fe,disabled:We,"data-testid":O.Tp.components.DataSourcePicker.inputV2,inputId:Ye||"data-source-picker",className:"ds-picker select-container",isClearable:Je,backspaceRemovesValue:!0,onChange:pe,options:ue,autoFocus:Re,onBlur:xe,width:Ve,openMenuOnFocus:Me,maxMenuHeight:500,placeholder:Be,noOptionsMessage:"No datasources found",value:Ne??[],invalid:!!Se?.error||!!L.invalid,getOptionLabel:G=>G.meta&&(0,te.x)(G.meta.signature)&&G!==Ne?a.createElement(i.B,{alignItems:"center",justifyContent:"space-between"},a.createElement("span",null,G.label)," ",a.createElement(oe.B,{status:G.meta.signature})):G.label||""}))},K=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],$=[{label:"Alert ",value:f.JS.Alerting},{label:"Recording ",value:f.JS.Recording}],Q=[{label:"Ok",value:b.Jc.Ok},{label:"No Data",value:b.Jc.NoData},{label:"Error",value:b.Jc.Error}],Ce=Object.entries(f.cF).map(([L,X])=>({label:(0,A.XI)(X),value:X})),ye=({onFilterCleared:L=()=>{}})=>{const X=(0,r.of)(et),[Se,Le]=(0,M.l)(),{pluginsFilterEnabled:pe}=je(),{filterState:F,hasActiveFilters:Ue,searchQuery:Re,setSearchQuery:xe,updateFilters:ie}=(0,U.dI)(),[Me,Be]=(0,a.useState)(Math.floor(Math.random()*100)),Ve=`dataSource-${Me}`,Ye=`queryString-${Me}`,We=(0,a.useRef)(null),{handleSubmit:Fe,register:ue,setValue:Ne}=(0,l.mN)({defaultValues:{searchQuery:Re}}),{ref:Je,...G}=ue("searchQuery");(0,a.useEffect)(()=>{Ne("searchQuery",Re)},[Re,Ne]);const ne=(I,Ge)=>{const be=Ge==="add"?[...F.dataSourceNames].concat([I.name]):F.dataSourceNames.filter(Ae=>Ae!==I.name);ie({...F,dataSourceNames:be}),Be(Ae=>Ae+1),(0,N.Sn)("dataSourceNames")},ve=I=>{ie({...F,dashboardUid:I}),(0,N.Sn)("dashboardUid")},ge=()=>{ie({...F,dataSourceNames:[]}),Be(I=>I+1)},Z=I=>{(0,N.fH)(N.le.clickingAlertStateFilters),ie({...F,ruleState:I}),(0,N.Sn)("ruleState")},w=I=>{ie({...F,ruleType:I}),(0,N.Sn)("ruleType")},Ke=I=>{ie({...F,ruleHealth:I}),(0,N.Sn)("ruleHealth")},Qe=()=>{xe(void 0),L(),setTimeout(()=>Be(Me+1),100)},$e=I=>{Le({view:I}),(0,N.aL)({view:I})},Xe=a.createElement(d.I,{name:"search"});return a.createElement("div",{className:X.container},a.createElement(i.B,{direction:"column",gap:1},a.createElement(i.B,{direction:"row",gap:1,wrap:"wrap"},a.createElement(E.D,{className:X.dsPickerContainer,label:a.createElement(h.J,{htmlFor:"data-source-picker"},a.createElement(i.B,{gap:.5,alignItems:"center"},a.createElement("span",null,"Search by data sources"),a.createElement(v.m,{content:a.createElement("div",null,a.createElement("p",null,"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."),a.createElement("p",null,"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."))},a.createElement(d.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:"Search by data sources help"}))))},a.createElement(ce,{key:Ve,alerting:!0,noDefault:!0,placeholder:"All data sources",current:F.dataSourceNames,onChange:ne,onClear:ge})),a.createElement(E.D,{className:X.dashboardPickerContainer,label:a.createElement(h.J,{htmlFor:"filters-dashboard-picker"},"Dashboard")},a.createElement(p.b,{inputId:"filters-dashboard-picker",key:F.dashboardUid?"dashboard-defined":"dashboard-not-defined",value:F.dashboardUid,onChange:I=>ve(I?.uid),isClearable:!0,cacheOptions:!0})),a.createElement("div",null,a.createElement(h.J,null,"State"),a.createElement(g.z,{options:Ce,value:F.ruleState,onChange:Z})),a.createElement("div",null,a.createElement(h.J,null,"Rule type"),a.createElement(g.z,{options:$,value:F.ruleType,onChange:w})),a.createElement("div",null,a.createElement(h.J,null,"Health"),a.createElement(g.z,{options:Q,value:F.ruleHealth,onChange:Ke})),pe&&a.createElement("div",null,a.createElement(h.J,null,"Plugin rules"),a.createElement(g.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:F.plugins,onChange:I=>ie({...F,plugins:I})}))),a.createElement(i.B,{direction:"column",gap:1},a.createElement(i.B,{direction:"row",gap:1},a.createElement("form",{className:X.searchInput,onSubmit:Fe(I=>{xe(I.searchQuery),We.current?.blur(),(0,N.zs)({oldQuery:Re,newQuery:I.searchQuery})})},a.createElement(E.D,{label:a.createElement(h.J,{htmlFor:"rulesSearchInput"},a.createElement(i.B,{gap:.5,alignItems:"center"},a.createElement("span",null,"Search"),a.createElement(z.j,{content:a.createElement(_e,null)},a.createElement(d.I,{name:"info-circle",size:"sm",tabIndex:0,title:"Search help"}))))},a.createElement(m.p,{id:"rulesSearchInput",key:Ye,prefix:Xe,ref:I=>{Je(I),We.current=I},...G,placeholder:"Search","data-testid":"search-query-input"})),a.createElement("input",{type:"submit",hidden:!0})),a.createElement("div",null,a.createElement(h.J,null,"View as"),a.createElement(g.z,{options:K,value:Se.get("view")??K[0].value,onChange:$e}))),Ue&&a.createElement("div",null,a.createElement(R.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:Qe},"Clear filters")))))},et=L=>({container:(0,e.css)({marginBottom:L.spacing(1)}),dsPickerContainer:(0,e.css)({width:L.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,e.css)({minWidth:L.spacing(50)}),searchInput:(0,e.css)({flex:1,margin:0})});function _e(){const L=(0,r.of)(He);return a.createElement("div",null,a.createElement("div",null,"Search syntax allows to query alert rules by the parameters defined below."),a.createElement("hr",null),a.createElement("div",{className:L.grid},a.createElement("div",null,"Filter type"),a.createElement("div",null,"Expression"),a.createElement(ae,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),a.createElement(ae,{title:"Folder/Namespace",expr:"namespace:global"}),a.createElement(ae,{title:"Group",expr:"group:cpu-usage"}),a.createElement(ae,{title:"Rule",expr:'rule:"cpu 80%"'}),a.createElement(ae,{title:"Labels",expr:"label:team=A label:cluster=a1"}),a.createElement(ae,{title:"State",expr:"state:firing|normal|pending"}),a.createElement(ae,{title:"Type",expr:"type:alerting|recording"}),a.createElement(ae,{title:"Health",expr:"health:ok|nodata|error"}),a.createElement(ae,{title:"Dashboard UID",expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"})))}function ae({title:L,expr:X}){const Se=(0,r.of)(He);return a.createElement(a.Fragment,null,a.createElement("div",null,L),a.createElement("code",{className:Se.code},X))}const He=L=>({grid:(0,e.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:L.spacing(1),alignItems:"center"}),code:(0,e.css)({display:"block",textAlign:"center"})});function je(){const{extensions:L}=(0,W.u)();return{pluginsFilterEnabled:L.length>0}}const tt=ye},86171:(V,P,t)=>{t.d(P,{u:()=>l});var e=t(74135),a=t(3197);function l(){return(0,a.kr)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},10940:(V,P,t)=>{t.d(P,{A:()=>l});var e=t(96540),a=function(r,d){var i=(0,e.useRef)(function(){});(0,e.useEffect)(function(){i.current=r}),(0,e.useEffect)(function(){if(d!==null){var E=setInterval(function(){return i.current()},d||0);return function(){return clearInterval(E)}}},[d])};const l=a}}]);

//# sourceMappingURL=AlertRuleListIndex.d2c419e4ed6b4c32821b.js.map