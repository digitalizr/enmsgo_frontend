"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:($,O,e)=>{e.d(O,{Y:()=>l});var P=e(96540),t=e(41053),o=e(10096),T=e(31678),u=e(37425),M=e(85927);const l=({teamId:d,roleOptions:i,disabled:s,roles:m,onApplyRoles:_,pendingRoles:g,apply:I=!1,maxWidth:S,width:K,isLoading:L})=>{const[{loading:y,value:D=m||[]},A]=(0,t.A)(async()=>{try{if(m)return m;if(I&&g?.length)return g;if(o.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesList)&&d>0)return await(0,M.xN)(d)}catch(h){console.error("Error loading options",h)}return[]},[d,g,m]);(0,P.useEffect)(()=>{A()},[A]);const B=async h=>{I?_&&_(h):(await(0,M.G3)(h,d),await A())},p=o.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesAdd)&&o.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesRemove);return P.createElement(u.n,{apply:I,onRolesChange:B,roleOptions:i,appliedRoles:D,isLoading:y||L,disabled:s,basicRoleDisabled:!0,canUpdateRoles:p,maxWidth:S,width:K})}},76323:($,O,e)=>{e.d(O,{J:()=>u});var P=e(32196),t=e(96540),o=e(14110),T=e(40845);const u=({text:l="PRO",className:d,experimentId:i,eventVariant:s="",...m})=>{const _=(0,T.of)(M);return(0,t.useEffect)(()=>{i&&(0,o.Xp)(i,"test",s)},[i,s]),t.createElement("span",{className:(0,P.cx)(_.badge,d),...m},l)},M=l=>({badge:(0,P.css)`
      margin-left: ${l.spacing(1.25)};
      border-radius: ${l.shape.borderRadius(5)};
      background-color: ${l.colors.success.main};
      padding: ${l.spacing(.25,.75)};
      color: white; // use the same color for both themes
      font-weight: ${l.typography.fontWeightMedium};
      font-size: ${l.typography.pxToRem(10)};
    `})},35538:($,O,e)=>{e.d(O,{pL:()=>t,z5:()=>T});var P=e(32264);const t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function o(){const u=P.$.licenseInfo?.trialExpiry;return!!(u&&u>0)}const T=()=>o()&&P.$.featureToggles.featureHighlights},52576:($,O,e)=>{e.r(O),e.d(O,{TeamList:()=>G,default:()=>W});var P=e(32196),t=e(96540),o=e(70255),T=e(71468),u=e(40845),M=e(12942),l=e(72109),d=e(67061),i=e(55852),s=e(91605),m=e(69529),_=e(14186),g=e(67647),I=e(48840),S=e(19384),K=e(67608),L=e(85927),y=e(8484),D=e(16233),A=e(31678),B=e(31084),p=e(33667);const h=new Array(3).fill(null).map((f,R)=>({id:R,memberCount:0,name:"",orgId:0,permission:0})),G=({teams:f,query:R,noTeams:x,hasFetched:C,loadTeams:z,deleteTeam:U,changeQuery:V,totalPages:H,page:X,rolesLoading:j,changePage:w,changeSort:F})=>{const[Q,k]=(0,t.useState)([]),b=(0,u.of)(N);(0,t.useEffect)(()=>{z(!0)},[z]),(0,t.useEffect)(()=>{D.TP.licensedAccessControlEnabled()&&D.TP.hasPermission(A.AccessControlAction.ActionRolesList)&&(0,L.RL)().then(c=>k(c))},[]);const Z=D.TP.hasPermission(A.AccessControlAction.ActionTeamsCreate),J=a(),q=(0,t.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:c}})=>C?c&&t.createElement(M.e,{src:c,alt:"User avatar"}):t.createElement(o.A,{containerClassName:b.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:c},row:{original:v}})=>C?D.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRead,v)?t.createElement(l.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${v.id}`,title:"Edit team"},c):c:t.createElement(o.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>C?c:t.createElement(o.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:c}})=>C?c:t.createElement(o.A,{width:40}),sortType:"number"},...J?[{id:"role",header:"Role",cell:({cell:{value:c},row:{original:v}})=>C?D.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRolesList,v)&&t.createElement(B.Y,{teamId:v.id,roles:v.roles||[],isLoading:j,roleOptions:Q,width:40}):t.createElement(o.A,{width:320,height:32,containerClassName:b.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:c}})=>{if(!C)return t.createElement(d.B,{direction:"row",justifyContent:"flex-end",alignItems:"center"},t.createElement(o.A,{containerClassName:b.blockSkeleton,width:16,height:16}),t.createElement(o.A,{containerClassName:b.blockSkeleton,width:22,height:24}));const v=D.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsRead,c),Y=D.TP.hasPermissionInMetadata(A.AccessControlAction.ActionTeamsDelete,c);return t.createElement(d.B,{direction:"row",justifyContent:"flex-end",gap:2},v&&t.createElement(i.z9,{href:`org/teams/edit/${c.id}`,"aria-label":`Edit team ${c.name}`,icon:"pen",size:"sm",variant:"secondary",tooltip:"Edit team"}),t.createElement(s.e,{"aria-label":`Delete team ${c.name}`,size:"sm",disabled:!Y,onConfirm:()=>U(c.id)}))}}],[J,C,j,Q,U,b]);return t.createElement(K.Y,{navId:"teams",actions:x?void 0:t.createElement(i.z9,{href:Z?"org/teams/new":"#",disabled:!Z},"New Team")},t.createElement(K.Y.Contents,null,x?t.createElement(m.p,{variant:"call-to-action",button:t.createElement(i.z9,{disabled:!Z,href:"org/teams/new",icon:"users-alt",size:"lg"},t.createElement(y.x6,{i18nKey:"teams.empty-state.button-title"},"New team")),message:(0,y.t)("teams.empty-state.title","You haven't created any teams yet")},t.createElement(y.x6,{i18nKey:"teams.empty-state.pro-tip"},"Assign folder and dashboard permissions to teams instead of users to ease administration."," ",t.createElement(l.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management"},"Learn more"))):t.createElement(t.Fragment,null,t.createElement("div",{className:"page-action-bar"},t.createElement(_.I,{grow:!0},t.createElement(g.Z,{placeholder:"Search teams",value:R,onChange:V}))),C&&f.length===0?t.createElement(m.p,{variant:"not-found",message:(0,y.t)("teams.empty-state.message","No teams found")}):t.createElement(d.B,{direction:"column",gap:2},t.createElement(I.j,{columns:q,data:C?f:h,getRowId:c=>String(c.id),fetchData:F}),t.createElement(d.B,{justifyContent:"flex-end"},t.createElement(S.d,{hideWhenSinglePage:!0,currentPage:X,numberOfPages:H,onNavigate:w}))))))};function a(){return D.TP.licensedAccessControlEnabled()&&D.TP.hasPermission(A.AccessControlAction.ActionTeamsRolesList)&&D.TP.hasPermission(A.AccessControlAction.ActionRolesList)}function n(f){return{teams:f.teams.teams,query:f.teams.query,perPage:f.teams.perPage,page:f.teams.page,noTeams:f.teams.noTeams,totalPages:f.teams.totalPages,hasFetched:f.teams.hasFetched,rolesLoading:f.teams.rolesLoading}}const r={loadTeams:p.Bu,deleteTeam:p.To,changePage:p.yd,changeQuery:p.nM,changeSort:p.Vk},W=(0,T.connect)(n,r)(G),N=f=>({blockSkeleton:(0,P.css)({lineHeight:1,display:"flex"})})},33667:($,O,e)=>{e.d(O,{Bu:()=>s,It:()=>p,To:()=>g,Vk:()=>K,aK:()=>B,eo:()=>_,n7:()=>A,nC:()=>h,nM:()=>I,yd:()=>S});var P=e(2543),t=e.n(P),o=e(17172),T=e(82467),u=e(10096),M=e(80714),l=e(31678),d=e(78319),i=e(34655);function s(a=!1){return async(n,r)=>{const{query:E,page:W,perPage:N,sort:f}=r().teams;if(!u.TP.hasPermission(l.AccessControlAction.ActionTeamsRead)){n((0,i.Q9)({teams:[],totalCount:0,page:1,perPage:N,noTeams:!0}));return}const R=await(0,o.AI)().get("/api/teams/search",(0,M.F)({query:E,page:W,perpage:N,sort:f}));let x=!1;if(a&&(x=R.teams.length===0),u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(l.AccessControlAction.ActionTeamsRolesList)){n((0,i.dJ)());const C=R?.teams.map(U=>U.id),z=await(0,o.AI)().post("/api/access-control/teams/roles/search",{teamIds:C});R.teams.forEach(U=>{U.roles=z?z[U.id]||[]:[]}),n((0,i.jE)())}n((0,i.Q9)({noTeams:x,...R}))}}const m=(0,P.debounce)(a=>a(s()),500);function _(a){return async n=>{const r=await(0,o.AI)().get(`/api/teams/${a}`,(0,M.F)());n((0,i.$T)(r)),n((0,T.Vz)((0,d.R)(r)))}}function g(a){return async n=>{await(0,o.AI)().delete(`/api/teams/${a}`),await u.TP.fetchUserPermissions(),n(s())}}function I(a){return async n=>{n((0,i.L5)(a)),m(n)}}function S(a){return async n=>{n((0,i.EC)(a)),n(s())}}function K({sortBy:a}){const n=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async r=>{r((0,i.$u)(n)),r(s())}}function L(){return async(a,n)=>{const r=n().team.team,E=await getBackendSrv().get(`/api/teams/${r.id}/members`);a(teamMembersLoaded(E))}}function y(a){return async(n,r)=>{const E=r().team.team;await getBackendSrv().post(`/api/teams/${E.id}/members`,{userId:a}),n(L())}}function D(a){return async(n,r)=>{const E=r().team.team;await getBackendSrv().delete(`/api/teams/${E.id}/members/${a}`),n(L())}}function A(a,n){return async(r,E)=>{const W=E().team.team;await(0,o.AI)().put(`/api/teams/${W.id}`,{name:a,email:n}),r(_(W.id))}}function B(){return async(a,n)=>{const r=n().team.team,E=await(0,o.AI)().get(`/api/teams/${r.id}/groups`);a((0,i.tC)(E))}}function p(a){return async(n,r)=>{const E=r().team.team;await(0,o.AI)().post(`/api/teams/${E.id}/groups`,{groupId:a}),n(B())}}function h(a){return async(n,r)=>{const E=r().team.team;await(0,o.AI)().delete(`/api/teams/${E.id}/groups?groupId=${encodeURIComponent(a)}`),n(B())}}function G(a){return async n=>{await getBackendSrv().put(`/api/teams/${a.teamId}/members/${a.userId}`,{permission:a.permission}),n(L())}}},78319:($,O,e)=>{e.d(O,{R:()=>d,X:()=>i});var P=e(33378),t=e(76323),o=e(2913),T=e(16233),u=e(35538),M=e(31678);const l={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:M.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function d(s){const m={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===l||T.TP.hasPermissionInMetadata(M.AccessControlAction.ActionTeamsPermissionsRead,s))&&m.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const _={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},g=s===l;return(0,u.z5)()&&(_.tabSuffix=()=>(0,t.J)({experimentId:g?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,P.a)("teamsync")?(g||T.TP.hasPermissionInMetadata(M.AccessControlAction.ActionTeamsPermissionsRead,s))&&m.children.push(_):o.Ay.featureToggles.featureHighlights&&m.children.push({..._,tabSuffix:()=>(0,t.J)({experimentId:g?"":"feature-highlights-team-sync-badge"})}),m}function i(s){const m=d(l);let _;for(const g of m.children)if(g.id.indexOf(s)>0){g.active=!0,_=g;break}return{main:m,node:_}}}}]);

//# sourceMappingURL=TeamList.b22a2e610af0b82f163c.js.map