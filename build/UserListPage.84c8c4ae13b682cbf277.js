"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743,9856],{20972:(Ue,S,a)=>{a.r(S),a.d(S,{default:()=>Qe});var s=a(32196),e=a(96540),A=a(13544),N=a(32264),U=a(33378),p=a(40675),L=a(40845),z=a(63021),d=a(8484),j=a(16233),Y=a(72254),F=a(67608),Z=a(31678),k=a(31083),q=a(71468),_=a(67647),B=a(94354),D=a(55852),oe=a(69529),ce=a(10096),H=a(12942),ie=a(72109),T=a(67061),f=a(56034),y=a(14578),K=a(94753),ee=a(78369),$=a(48840),te=a(19384),b=a(46334),I=a(90613);const ae=({units:t,icon:r})=>t?.length?t.length>1?e.createElement(f.m,{placement:"top",content:e.createElement(T.B,{direction:"column"},t?.map(o=>e.createElement("span",{key:o.name},o.name)))},e.createElement(O,{icon:r},t.length)):e.createElement(O,{icon:r},t[0].name):null,O=(0,e.forwardRef)(({children:t,icon:r},o)=>e.createElement(I.a,{ref:o,display:"flex",alignItems:"center",marginRight:1},e.createElement(y.I,{name:r})," ",e.createElement(I.a,{marginLeft:1},t)));O.displayName="TooltipContent";const J=({users:t,showPaging:r,totalPages:o,onChangePage:u,currentPage:h,fetchData:g})=>{const M=(0,e.useMemo)(()=>t.some(l=>l.licensedRole),[t]),E=(0,e.useMemo)(()=>t.some(l=>l.orgs),[t]),X=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:l}})=>l&&e.createElement(H.e,{src:l,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:l}})=>e.createElement(ie.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${l.id}`,title:"Edit user"},l.login),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:l}})=>l,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:l}})=>l,sortType:"string"},...E?[{id:"orgs",header:"Belongs to",cell:({cell:{value:l,row:R}})=>e.createElement(T.B,{alignItems:"center"},e.createElement(ae,{units:l,icon:"building"}),R.original.isAdmin&&e.createElement(f.m,{placement:"top",content:"Grafana Admin"},e.createElement(y.I,{name:"shield"}))),sortType:(l,R)=>(l.original.orgs?.length||0)-(R.original.orgs?.length||0)}]:[],...M?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:l}})=>l==="None"?e.createElement(K.E,{color:"disabled"},"Not assigned"," ",e.createElement(f.m,{placement:"top",content:"A licensed role will be assigned when this user signs in"},e.createElement(y.I,{name:"question-circle"}))):l,sortType:"string"}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:l}})=>e.createElement(e.Fragment,null,l&&e.createElement(e.Fragment,null,l==="10 years"?e.createElement(K.E,{color:"disabled"},"Never"):l)),sortType:(l,R)=>new Date(l.original.lastSeenAt).getTime()-new Date(R.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:l}})=>e.createElement(e.Fragment,null,Array.isArray(l)&&l.length>0&&e.createElement(b.E,{label:l[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:l}})=>e.createElement(e.Fragment,null,l&&e.createElement(ee.v,{colorIndex:9,name:"Disabled"}))},{id:"edit",header:"",cell:({row:{original:l}})=>e.createElement(D.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${l.id}`,"aria-label":`Edit user ${l.name}`,tooltip:"Edit user"})}],[M,E]);return e.createElement(T.B,{direction:"column",gap:2},e.createElement($.j,{columns:X,data:t,getRowId:l=>String(l.id),fetchData:g}),r&&e.createElement(T.B,{justifyContent:"flex-end"},e.createElement(te.d,{numberOfPages:o,currentPage:h,onNavigate:u})))};var P=a(57334);const se=[],ve=t=>{se.push(t)},c=A.Tp.pages.UserListPage.UserListAdminPage,v={fetchUsers:P.hU,changeQuery:P.nM,changePage:P.yd,changeFilter:P.$u,changeSort:P.Vk},ne=t=>({users:t.userListAdmin.users,query:t.userListAdmin.query,showPaging:t.userListAdmin.showPaging,totalPages:t.userListAdmin.totalPages,page:t.userListAdmin.page,filters:t.userListAdmin.filters,isLoading:t.userListAdmin.isLoading}),Le=(0,q.connect)(ne,v)(({fetchUsers:t,query:r,changeQuery:o,users:u,showPaging:h,changeFilter:g,filters:M,totalPages:E,page:X,changePage:l,changeSort:R,isLoading:Be})=>{const Ae=(0,L.of)(De);return(0,e.useEffect)(()=>{t()},[t]),e.createElement(F.Y.Contents,null,e.createElement("div",{className:Ae.actionBar,"data-testid":c.container},e.createElement("div",{className:Ae.row},e.createElement(_.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:r,onChange:o}),e.createElement(B.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:he=>g({name:"activeLast30Days",value:he}),value:M.find(he=>he.name==="activeLast30Days")?.value,className:Ae.filter}),se.map((he,je)=>e.createElement(he,{key:je,filters:M,onChange:g,className:Ae.filter})),ce.TP.hasPermission(Z.AccessControlAction.UsersCreate)&&e.createElement(D.z9,{href:"admin/users/create",variant:"primary"},"New user"))),!Be&&u.length===0?e.createElement(oe.p,{message:(0,d.t)("users.empty-state.message","No users found"),variant:"not-found"}):e.createElement(J,{users:u,showPaging:h,totalPages:E,onChangePage:l,currentPage:X,fetchData:R}))});function Oe(){return React.createElement(Page,{navId:"global-users"},React.createElement(Le,null))}const De=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),Se=null;var Te=a(39938),pe=a(23088);const ye=t=>{if(!t.includes(" "))return{browser:t,computer:""};const r=t.split(" ");return{browser:r[0],computer:r[1]}},Pe=(t,r)=>t.length>r?t.substring(0,r)+"...":t,n=({value:t})=>{const r=ye(t);return e.createElement(f.m,{theme:"info-alt",content:t,placement:"top-end",interactive:!0},e.createElement("span",null,Pe(r.browser,10),Pe(r.computer,10)))},i=({devices:t,showPaging:r,totalPages:o,onChangePage:u,currentPage:h,fetchData:g})=>{const M=(0,e.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:E}})=>E&&e.createElement(H.e,{src:E,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:E}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:E}})=>e.createElement(n,{value:E}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:E}})=>E,sortType:(E,X)=>new Date(E.original.updatedAt).getTime()-new Date(X.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:E}})=>E&&e.createElement(Te.E,{text:E,color:"orange"})}],[]);return e.createElement(T.B,{direction:"column",gap:2},e.createElement($.j,{columns:M,data:t,getRowId:E=>E.deviceId,fetchData:g}),r&&e.createElement(T.B,{justifyContent:"flex-end"},e.createElement(te.d,{numberOfPages:o,currentPage:h,onNavigate:u})),t.length===0&&e.createElement(pe.Z,null,e.createElement("span",null,"No anonymous users found.")))},m={fetchUsersAnonymousDevices:P.xq,changeAnonUserSort:P.A5,changeAnonPage:P.is,changeAnonQuery:P.Bc},C=t=>({devices:t.userListAnonymousDevices.devices,query:t.userListAnonymousDevices.query,showPaging:t.userListAnonymousDevices.showPaging,totalPages:t.userListAnonymousDevices.totalPages,page:t.userListAnonymousDevices.page,filters:t.userListAnonymousDevices.filters}),x=A.Tp.pages.UserListPage.UserListAdminPage,W=(0,q.connect)(C,m)(({devices:t,fetchUsersAnonymousDevices:r,query:o,changeAnonQuery:u,filters:h,showPaging:g,totalPages:M,page:E,changeAnonPage:X,changeAnonUserSort:l})=>{const R=(0,L.of)(G);return(0,e.useEffect)(()=>{r()},[r]),e.createElement(F.Y.Contents,null,e.createElement("div",{className:R.actionBar,"data-testid":x.container},e.createElement("div",{className:R.row},e.createElement(_.Z,{placeholder:"Search devices by ip adress.",autoFocus:!0,value:o,onChange:u}),e.createElement(B.z,{options:[{label:"Active last 30 days",value:!0}],value:h.find(Be=>Be.name==="activeLast30Days")?.value,className:R.filter}))),e.createElement(i,{devices:t,showPaging:g,totalPages:M,onChangePage:X,currentPage:E,fetchData:l}))});function le(){return React.createElement(Page,{navId:"anonymous-users"},React.createElement(W,null))}const G=t=>({filter:(0,s.css)({margin:t.spacing(0,1),[t.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,s.css)({marginBottom:t.spacing(2),display:"flex",alignItems:"flex-start",gap:t.spacing(2),[t.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,s.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:t.spacing(.5),flexGrow:1,[t.breakpoints.down("sm")]:{flexWrap:"wrap",gap:t.spacing(2),width:"100%"}})}),V=null;var de=a(72686),me=a(37390),ge=a(39558),fe=a(71678);const be=A.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,Ie=({email:t,onDismiss:r})=>{const o=(0,L.of)(xe),{data:u,isLoading:h}=(0,de.kd)(t);return e.createElement(me.a,{className:o.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:r},h?e.createElement("div",{className:o.loading},e.createElement(ge._,{text:(0,d.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})):u?.map(g=>e.createElement("div",{key:g.dashboardUid,className:o.listItem,"data-testid":be.listItem(g.dashboardUid)},e.createElement("p",{className:o.dashboardTitle},g.dashboardTitle),e.createElement("div",{className:o.urlsContainer},e.createElement("a",{rel:"noreferrer",target:"_blank",className:(0,s.cx)("external-link",o.url),href:(0,Y.mL)(g.publicDashboardAccessToken),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link"},"Public dashboard URL")),e.createElement("span",{className:o.urlsDivider},"\u2022"),e.createElement("a",{className:(0,s.cx)("external-link",o.url),href:(0,Y.gN)(g.dashboardUid,g.slug),onClick:r},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting"},"Public dashboard settings"))),e.createElement("hr",{className:o.divider}))))},Ce=({email:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return e.createElement(fe.$s,null,({showModal:o,hideModal:u})=>e.createElement(D.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:r,"aria-label":r,onClick:()=>o(Ie,{email:t,onDismiss:u})}))},xe=t=>({modal:(0,s.css)`
    width: 590px;
  `,loading:(0,s.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,s.css)`
    display: flex;
    flex-direction: column;
    gap: ${t.spacing(.5)};
  `,divider:(0,s.css)`
    margin: ${t.spacing(1.5,0)};
    color: ${t.colors.text.secondary};
  `,urlsContainer:(0,s.css)`
    display: flex;
    gap: ${t.spacing(.5)};

    ${t.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,s.css)`
    color: ${t.colors.text.secondary};
    ${t.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
    font-weight: ${t.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,s.css)`
    font-size: ${t.typography.body.fontSize};
  `}),Me=({user:t,hideModal:r})=>{const[o]=(0,de.g9)(),u=(0,L.of)(Re),h=()=>{o({email:t.email}),r()};return e.createElement(me.a,{className:u.modal,isOpen:!0,title:(0,d.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:r},e.createElement("p",{className:u.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1"},"Are you sure you want to revoke access for ",{email:t.email},"?")),e.createElement("p",{className:u.description},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0},"This action will immediately revoke ",{email:t.email},"'s access to all public dashboards.")),e.createElement(me.a.ButtonRow,null,e.createElement(D.$n,{type:"button",variant:"secondary",onClick:r,fill:"outline"},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button"},"Cancel")),e.createElement(D.$n,{type:"button",variant:"destructive",onClick:h},e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button"},"Revoke access"))))},ue=({user:t})=>{const r=(0,d.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return e.createElement(fe.$s,null,({showModal:o,hideModal:u})=>e.createElement(D.$n,{size:"sm",variant:"destructive",onClick:()=>o(Me,{user:t,hideModal:u}),icon:"times","aria-label":r,title:r}))},Re=t=>({modal:(0,s.css)({width:"500px"}),description:(0,s.css)({fontSize:t.typography.body.fontSize,margin:0})}),$e=A.Tp.pages.UserListPage.publicDashboards,We=()=>{const{data:t,isLoading:r}=(0,de.AK)();return e.createElement(F.Y.Contents,{isLoading:r},e.createElement("table",{className:"filter-table form-inline","data-testid":$e.container},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label"},"Email")),e.createElement("th",null,e.createElement("span",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label"},"Activated")),e.createElement(f.m,{placement:"top",content:(0,d.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard")},e.createElement(y.I,{name:"question-circle"}))),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label"},"Last active")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label"},"Origin")),e.createElement("th",null,e.createElement(d.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label"},"Role")),e.createElement("th",null))),e.createElement("tbody",null,t?.map(o=>e.createElement("tr",{key:o.email},e.createElement("td",{className:"max-width-10"},e.createElement("span",{className:"ellipsis",title:o.email},o.email)),e.createElement("td",{className:"max-width-10"},o.firstSeenAtAge),e.createElement("td",{className:"max-width-10"},o.lastSeenAtAge),e.createElement("td",{className:"max-width-10"},e.createElement(T.B,{gap:2},e.createElement("span",null,o.totalDashboards," dashboard(s)"),e.createElement(Ce,{email:o.email}))),e.createElement("td",{className:"max-width-10"},e.createElement(ee.v,{name:"Viewer",colorIndex:19})),e.createElement("td",{className:"text-right"},e.createElement(ue,{user:o})))))))};var ze=(t=>(t.ADMIN="admin",t.ORG="org",t.PUBLIC_DASHBOARDS="public-dashboards",t.ANON="anon",t))(ze||{});const Ee=A.Tp.pages.UserListPage,Ne=({view:t,setView:r})=>e.createElement(p.o,{label:(0,d.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:t==="public-dashboards",onChangeTab:()=>r("public-dashboards"),"data-testid":Ee.tabs.publicDashboardsUsers}),Fe={admin:e.createElement(Le,null),org:e.createElement(k.UsersListPageContent,null),"public-dashboards":e.createElement(We,null),anon:e.createElement(W,null)};function Qe(){const t=(0,L.of)(Ge),r=j.TP.hasPermission(Z.AccessControlAction.UsersRead),o=j.TP.hasPermission(Z.AccessControlAction.OrgUsersRead),u=(0,Y.iR)()&&!!N.$.featureToggles.publicDashboardsEmailSharing&&(0,U.a)("publicDashboardsEmailSharing"),[h,g]=(0,e.useState)(()=>r?"admin":o?"org":null),M=o&&r;return e.createElement(F.Y,{navId:"global-users"},M?e.createElement(z.U,{className:t.tabsMargin},e.createElement(p.o,{label:"All users",active:h==="admin",onChangeTab:()=>g("admin"),"data-testid":Ee.tabs.allUsers}),e.createElement(p.o,{label:"Organization users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":Ee.tabs.orgUsers}),N.$.anonymousEnabled&&e.createElement(p.o,{label:"Anonymous devices",active:h==="anon",onChangeTab:()=>g("anon"),"data-testid":Ee.tabs.anonUserDevices}),u&&e.createElement(Ne,{view:h,setView:g})):u&&e.createElement(z.U,{className:t.tabsMargin},e.createElement(p.o,{label:"Users",active:h==="org",onChangeTab:()=>g("org"),"data-testid":Ee.tabs.users}),e.createElement(Ne,{view:h,setView:g})),h?Fe[h]:e.createElement(k.UsersListPageContent,null))}const Ge=t=>({tabsMargin:(0,s.css)({marginBottom:t.spacing(3)})})},69546:(Ue,S,a)=>{a.d(S,{b:()=>T});var s=a(96540),e=a(13544),A=a(12942),N=a(94753),U=a(90613),p=a(56034),L=a(14578),z=a(78369),d=a(55852),j=a(67061),Y=a(48840),F=a(19384),Z=a(96374),k=a(89062),q=a(85927),_=a(46334),B=a(10096),D=a(31678),oe=a(5133);const ce=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,H=f=>{const y=f?.isExternallySynced;return!B.TP.hasPermissionInMetadata(D.AccessControlAction.OrgUsersWrite,f)||y},ie=e.Tp.pages.UserListPage.UsersListPage,T=({users:f,orgId:y,onRoleChange:K,onRemoveUser:ee,fetchData:$,changePage:te,page:b,totalPages:I,rolesLoading:ae})=>{const[O,J]=(0,s.useState)(null),[P,se]=(0,s.useState)([]);(0,s.useEffect)(()=>{async function c(){try{if(B.TP.hasPermission(D.AccessControlAction.ActionRolesList)){let v=await(0,q.RL)(y);se(v)}}catch{console.error("Error loading options")}}B.TP.licensedAccessControlEnabled()&&c()},[y]);const ve=(0,s.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:c}})=>c&&s.createElement(A.e,{src:c,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:c}})=>s.createElement("div",null,c),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:c}})=>c,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(s.Fragment,null,c==="10 years"?s.createElement(N.E,{color:"disabled"},"Never"):c)),sortType:(c,v)=>new Date(c.original.lastSeenAt).getTime()-new Date(v.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:c},row:{original:v}})=>{const ne=H(v);return B.TP.licensedAccessControlEnabled()?s.createElement(k.y,{userId:v.userId,roles:v.roles||[],isLoading:ae,orgId:y,roleOptions:P,basicRole:c,onBasicRoleChange:re=>K(re,v),basicRoleDisabled:ne,basicRoleDisabledMessage:ce,width:40}):s.createElement(oe.r,{"aria-label":"Role",value:c,disabled:ne,onChange:re=>K(re,v)})}},{id:"info",header:"",cell:({row:{original:c}})=>H(c)&&s.createElement(U.a,{display:"flex",alignItems:"center",marginLeft:1},s.createElement(p.m,{interactive:!0,content:s.createElement("div",null,"This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",s.createElement("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank"},"Grafana authentication docs"),"\xA0for details.")},s.createElement(L.I,{name:"question-circle"})))},{id:"authLabels",header:"Origin",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,Array.isArray(c)&&c.length>0&&s.createElement(_.E,{label:c[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:c}})=>s.createElement(s.Fragment,null,c&&s.createElement(z.v,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:c}})=>B.TP.hasPermissionInMetadata(D.AccessControlAction.OrgUsersRemove,c)&&s.createElement(d.$n,{size:"sm",variant:"destructive",onClick:()=>{J(c)},icon:"times","aria-label":`Delete user ${c.name}`})}],[ae,y,P,K]);return s.createElement(j.B,{direction:"column",gap:2,"data-testid":ie.container},s.createElement(Y.j,{columns:ve,data:f,getRowId:c=>String(c.userId),fetchData:$}),s.createElement(j.B,{justifyContent:"flex-end"},s.createElement(F.d,{onNavigate:te,currentPage:b,numberOfPages:I,hideWhenSinglePage:!0})),!!O&&s.createElement(Z.u,{body:`Are you sure you want to delete user ${O?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{J(null)},isOpen:!0,onConfirm:()=>{O&&(ee(O),J(null))}}))}},23088:(Ue,S,a)=>{a.d(S,{Z:()=>N});var s=a(32196),e=a(96540),A=a(40845);const N=({children:p})=>{const L=(0,A.of)(U);return e.createElement("div",{className:L.container},p)},U=p=>({container:(0,s.css)({backgroundColor:p.colors.background.secondary,color:p.colors.text.secondary,padding:p.spacing(4),textAlign:"center"})})},31083:(Ue,S,a)=>{a.r(S),a.d(S,{UsersListPageContent:()=>ye,UsersListPageUnconnected:()=>pe,default:()=>Pe});var s=a(96540),e=a(71468),A=a(36663),N=a(67608),U=a(10096),p=a(69546),L=a(10534),z=a(55852),d=a(47259);const j={revokeInvite:d.eb},Y=(0,e.connect)(null,j);class F extends s.PureComponent{render(){const{invitee:i,revokeInvite:m}=this.props;return s.createElement("tr",null,s.createElement("td",null,i.email),s.createElement("td",null,i.name),s.createElement("td",{className:"text-right"},s.createElement(L.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>i.url},"Copy Invite"),"\xA0"),s.createElement("td",null,s.createElement(z.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>m(i.code),"aria-label":"Revoke Invite"})))}}const Z=Y(F);class k extends s.PureComponent{render(){const{invitees:i}=this.props;return s.createElement("table",{className:"filter-table form-inline"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,"Email"),s.createElement("th",null,"Name"),s.createElement("th",null),s.createElement("th",{style:{width:"34px"}}))),s.createElement("tbody",{"data-testid":"InviteesTable-body"},i.map((m,C)=>s.createElement(Z,{key:`${m.id}-${C}`,invitee:m}))))}}var q=a(25508),_=a(40823);const{selectAll:B,selectById:D,selectTotal:oe}=_.Tp,ce=(n,i)=>i,H=(0,q.Mz)([B,ce],(n,i)=>{const m=new RegExp(i,"i");return n.filter(x=>m.test(x.name)||m.test(x.email))});var ie=a(14186),T=a(67647),f=a(94354),y=a(2913),K=a(31678),ee=a(2543),$=a(17172),te=a(80714),b=a(87617);function I(){return async(n,i)=>{try{n((0,b.Cj)());const{perPage:m,page:C,searchQuery:x,sort:w}=i().users,Q=await(0,$.AI)().get("/api/org/users/search",(0,te.F)({perpage:m,page:C,query:x,sort:w}));if(U.TP.licensedAccessControlEnabled()&&U.TP.hasPermission(K.AccessControlAction.ActionUserRolesList)){n((0,b.dJ)());const W=U.TP.user.orgId,le=Q?.orgUsers.map(V=>V.userId),G=await(0,$.AI)().post("/api/access-control/users/roles/search",{userIds:le,orgId:W});Q.orgUsers.forEach(V=>{V.roles=G?G[V.userId]||[]:[]}),n((0,b.jE)())}n((0,b.Y_)(Q))}catch{(0,b.g4)()}}}const ae=(0,ee.debounce)(n=>n(I()),300);function O(n){return async i=>{await(0,$.AI)().patch(`/api/org/users/${n.userId}`,{role:n.role}),i(I())}}function J(n){return async i=>{await(0,$.AI)().delete(`/api/org/users/${n}`),i(I())}}function P(n){return async i=>{i((0,b.EC)(n)),i(I())}}function se({sortBy:n}){const i=n.length?`${n[0].id}-${n[0].desc?"desc":"asc"}`:void 0;return async m=>{m((0,b.$u)(i)),m(I())}}function ve(n){return async i=>{i((0,b.t_)(n)),ae(i)}}const c=n=>{const i=new RegExp(n.searchQuery,"i");return n.users.filter(m=>i.test(m.login)||i.test(m.email)||i.test(m.name))},v=n=>n.searchQuery;function ne(n){return{searchQuery:v(n.users),pendingInvitesCount:oe(n.invites),externalUserMngLinkName:n.users.externalUserMngLinkName,externalUserMngLinkUrl:n.users.externalUserMngLinkUrl}}const re={changeSearchQuery:ve},Oe=(0,e.connect)(ne,re)(({externalUserMngLinkName:n,externalUserMngLinkUrl:i,searchQuery:m,pendingInvitesCount:C,changeSearchQuery:x,onShowInvites:w,showInvites:Q})=>{const W=[{label:"Users",value:"users"},{label:`Pending Invites (${C})`,value:"invites"}],G=U.TP.hasPermission(K.AccessControlAction.OrgUsersAdd)&&!(y.Ay.disableLoginForm&&y.Ay.externalUserMngInfo);return s.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},s.createElement(ie.I,{grow:!0},s.createElement(T.Z,{value:m,onChange:x,placeholder:"Search user by login, email or name"})),C>0&&s.createElement("div",{style:{marginLeft:"1rem"}},s.createElement(f.z,{value:Q?"invites":"users",options:W,onChange:w})),G&&s.createElement(z.z9,{href:"org/users/invite"},"Invite"),i&&s.createElement(z.z9,{href:i,target:"_blank",rel:"noopener"},n))});function De(n){const i=v(n.users);return{users:c(n.users),searchQuery:v(n.users),page:n.users.page,totalPages:n.users.totalPages,perPage:n.users.perPage,invitees:H(n.invites,i),externalUserMngInfo:n.users.externalUserMngInfo,isLoading:n.users.isLoading,rolesLoading:n.users.rolesLoading}}const Se={loadUsers:I,fetchInvitees:d.G7,changePage:P,changeSort:se,updateUser:O,removeUser:J},Te=(0,e.connect)(De,Se),pe=({users:n,page:i,totalPages:m,invitees:C,externalUserMngInfo:x,isLoading:w,rolesLoading:Q,loadUsers:W,fetchInvitees:le,changePage:G,updateUser:V,removeUser:de,changeSort:me})=>{const[ge,fe]=(0,s.useState)(!1),be=x?(0,A.G)(x):"";(0,s.useEffect)(()=>{W(),le()},[le,W]);const Ie=(ue,Re)=>{V({...Re,role:ue})},Ce=ue=>de(ue.userId),xe=()=>{fe(!ge)},Me=()=>ge?s.createElement(k,{invitees:C}):s.createElement(p.b,{users:n,orgId:U.TP.user.orgId,rolesLoading:Q,onRoleChange:Ie,onRemoveUser:Ce,fetchData:me,changePage:G,page:i,totalPages:m});return s.createElement(N.Y.Contents,{isLoading:!w},s.createElement(Oe,{onShowInvites:xe,showInvites:ge}),be&&s.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:be}}),w&&Me())},ye=Te(pe);function Pe(){return s.createElement(N.Y,{navId:"users"},s.createElement(ye,null))}}}]);

//# sourceMappingURL=UserListPage.84c8c4ae13b682cbf277.js.map