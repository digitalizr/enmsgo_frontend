"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5592],{51332:(te,A,t)=>{t.r(A),t.d(A,{AuthConfigPageUnconnected:()=>q,default:()=>pe});var e=t(96540),p=t(71468),C=t(61268),y=t(14110),U=t(72109),H=t(27746),E=t(71259),L=t(67608),X=t(2913),w=t(32196),G=t(40845),v=t(87978),l=t(94753),u=t(15292),k=t(55852),ae=t(3169),P=t(60610);const M=i=>({allowInsecureEmail:i.authConfig.settings?.auth?.oauth_allow_insecure_email_lookup.toLowerCase()==="true"}),ve={loadSettings:P.M5,saveSettings:P.DZ},ue=(0,p.connect)(M,ve)(({allowInsecureEmail:i,loadSettings:I,onClose:O,saveSettings:S})=>{const R=(0,ae._2)(),F=async()=>{try{await S({updates:{auth:{oauth_allow_insecure_email_lookup:""+!i}}}),await I(!1),R.success("Settings saved")}catch{R.error("Failed to save settings")}},J=async()=>{try{await S({removals:{auth:["oauth_allow_insecure_email_lookup"]}}),await I(!1),R.success("Settings saved")}catch{R.error("Failed to save settings")}},V=e.createElement(e.Fragment,null,"Configure auth settings. Find out more in our"," ",e.createElement(U.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication/#settings"},"documentation"),"."),N=(0,G.of)(ce);return e.createElement(v._,{title:"Auth Settings",subtitle:V,size:"md",onClose:O},e.createElement("div",{className:N.advancedAuth},e.createElement(l.E,{variant:"h4"},"Advanced Auth"),e.createElement(l.E,{variant:"h5"},"Enable insecure email lookup"),e.createElement(l.E,{variant:"body",color:"secondary"},"Allow users to use the same email address to log into Grafana with different identity providers."),e.createElement(u.d,{value:i,onChange:F})),e.createElement(k.$n,{size:"md",variant:"secondary",className:N.button,onClick:J,tooltip:"This action will disregard any saved changes and load the configuration from the configuration file."},"Reset"))}),ce=i=>({advancedAuth:(0,w.css)({display:"flex",flexDirection:"column",gap:i.spacing(1)}),button:(0,w.css)({marginTop:i.spacing(2)})});var de=t(67061),me=t(14578);const be=()=>{const i=(0,G.of)(Ae);return e.createElement("div",{className:i.container},e.createElement(de.B,{gap:1,alignItems:"center"},e.createElement(me.I,{name:"cog"}),e.createElement(l.E,null,"Configuration required")),e.createElement(l.E,{variant:"bodySmall",color:"secondary"},"You have no authentication configuration created at the moment."),e.createElement(U.Y,{href:"https://grafana.com/docs/grafana/latest/auth/overview/",external:!0},"Refer to the documentation on how to configure authentication"))},Ae=i=>({container:(0,w.css)({display:"flex",flexDirection:"column",gap:i.spacing(2),backgroundColor:i.colors.background.secondary,borderRadius:i.shape.radius.default,padding:i.spacing(3),width:"max-content",margin:i.spacing(3,"auto")})}),Ee=be;var Se=t(8887),Y=t(10860),Ce=t(39938),fe=t(7250),ne=t(5328);function ge({providerId:i,enabled:I,configPath:O,authType:S,onClick:R}){const F=(0,ne.h)({configPath:O,id:i}),[J,V]=fe.L[i]||["lock",i.toUpperCase()];return e.createElement(Y.Z,{href:F,onClick:R},e.createElement(Y.Z.Heading,null,V),e.createElement(Y.Z.Meta,null,S),(0,Se.n6)(J)&&e.createElement(Y.Z.Figure,null,e.createElement(me.I,{name:J,size:"xxxl"})),e.createElement(Y.Z.Actions,null,e.createElement(Ce.E,{text:I?"Enabled":"Not enabled",color:I?"green":"blue"})))}var Pe=t(73399);function j(i){const{isLoading:I,providerStatuses:O,providers:S}=i.authConfig;return{isLoading:I,providerStatuses:O,providers:S}}const Q={loadSettings:P.M5},he=(0,p.connect)(j,Q),q=({providerStatuses:i,isLoading:I,loadSettings:O,providers:S})=>{(0,e.useEffect)(()=>{O()},[O]);const[R,F]=(0,e.useState)(!1),V=(0,Pe.getRegisteredAuthProviders)().filter(m=>!i[m.id]?.hide),N=(m,z)=>{(0,y.rR)("authentication_ui_provider_clicked",{provider:m,enabled:z})};S=S.filter(m=>m.provider!=="saml");const _=V.length?[...V.map(m=>({provider:m.id,settings:{...i[m.id],configPath:m.configPath,type:m.type}})),...S]:S;return e.createElement(L.Y,{navId:"authentication",subTitle:e.createElement(e.Fragment,null,"Manage your auth settings and configure single sign-on. Find out more in our"," ",e.createElement(U.Y,{external:!0,href:"https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication"},"documentation"),"."),actions:X.config.buildInfo.edition!==C.r.OpenSource&&e.createElement(H.I,{icon:"cog",variant:"canvas",onClick:()=>F(!0)},"Auth settings")},e.createElement(L.Y.Contents,{isLoading:I},_.length?e.createElement(E.x,{gap:3,minColumnWidth:34},_.filter(({provider:m})=>!["grafana_com"].includes(m)).map(({provider:m,settings:z})=>e.createElement(ge,{key:m,authType:z.type||"OAuth",providerId:m,enabled:z.enabled,onClick:()=>N(m,z.enabled),configPath:z.configPath})),R&&e.createElement(ue,{onClose:()=>F(!1)})):e.createElement(Ee,null)))},pe=he(q)},22468:(te,A,t)=>{t.r(A),t.d(A,{ProviderConfigPage:()=>we,default:()=>Me});var e=t(96540),p=t(71468),C=t(67061),y=t(94753),U=t(39938),H=t(67608),E=t(49785),L=t(26272),X=t(3591),w=t(17172),G=t(14110),v=t(12131),l=t(38138),u=t(88575),k=t(15292),ae=t(57418),P=t(90613),M=t(55852),ve=t(83122),De=t(29158),Ue=t(96374),ue=t(32196),ce=t(24180),de=t(37390);const me=({confirmRedirect:n,onDiscard:a,onLocationChange:s})=>{const[r,d]=(0,e.useState)(!1),[f,g]=(0,e.useState)(null),[b,ee]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const o=T=>{n&&(T.preventDefault(),T.returnValue="")};return window.addEventListener("beforeunload",o),()=>{window.removeEventListener("beforeunload",o)}},[n]);const se=o=>{const T=window.location.pathname,c=o.pathname;if(T===c)return!0;const Z=s?.(o);let x=n&&!b;return Z!==void 0&&(x=x&&Z),x?(d(!0),g(o),!1):(Z&&a(),!0)},re=()=>{d(!1),g(null)},B=()=>{d(!1),ee(!0),a()};return e.createElement(e.Fragment,null,e.createElement(ce.XG,{when:!0,message:se}),f&&b&&e.createElement(ce.rd,{to:f}),e.createElement(be,{isOpen:r,onDiscard:B,onBackToForm:re}))},be=({onDiscard:n,onBackToForm:a,isOpen:s})=>e.createElement(de.a,{isOpen:s,title:"Leave page?",onDismiss:a,icon:"exclamation-triangle",className:(0,ue.css)({width:"500px"})},e.createElement("h5",null,"Changes that you made may not be saved."),e.createElement(de.a.ButtonRow,null,e.createElement(M.$n,{variant:"secondary",onClick:a,fill:"outline"},"Continue editing"),e.createElement(M.$n,{variant:"destructive",onClick:n},"Discard unsaved changes")));var Ae=t(40845),Ee=t(10354),Se=t(9226),Y=t(21594),Ce=t(10880),fe=t(8227),ne=t(32264),ge=t(72109),Pe=t(10096);function j(n){return Array.isArray(n)&&n.every(a=>typeof a=="object"&&a!==null&&"value"in a)}var Q=t(5328);const he={azuread:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","allowedGroups","forceUseGraphApi","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],generic_oauth:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","authStyle","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["nameAttributePath","loginAttributePath","emailAttributeName","emailAttributePath","idTokenAttributeName","roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","defineAllowedGroups",{name:"allowedGroups",dependsOn:"defineAllowedGroups"},{name:"groupsAttributePath",dependsOn:"defineAllowedGroups"},"defineAllowedTeamsIds",{name:"teamIds",dependsOn:"defineAllowedTeamsIds"},{name:"teamsUrl",dependsOn:"defineAllowedTeamsIds"},{name:"teamIdsAttributePath",dependsOn:"defineAllowedTeamsIds"},"usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],google:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["validateHd","hostedDomain","allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],github:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedOrganizations","allowedDomains","teamIds","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],gitlab:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}],okta:[{name:"General settings",id:"general",fields:["name","clientId","clientSecret","scopes","authUrl","tokenUrl","apiUrl","allowSignUp","autoLogin","signoutRedirectUrl"]},{name:"User mapping",id:"user",fields:["roleAttributePath","roleAttributeStrict","allowAssignGrafanaAdmin","skipOrgRoleSync"]},{name:"Extra security measures",id:"extra",fields:["allowedDomains","allowedGroups","usePkce","useRefreshToken","tlsSkipVerifyInsecure","tlsClientCert","tlsClientKey","tlsClientCa"]}]};function q(n){return{clientId:{label:"Client Id",type:"text",description:"The client Id of your OAuth2 app.",validation:{required:!0,message:"This field is required"}},clientSecret:{label:"Client secret",type:"secret",description:"The client secret of your OAuth2 app."},allowedOrganizations:{label:"Allowed organizations",type:"select",description:`List of comma- or space-separated organizations. The user should be a member 
of at least one organization to log in.`,multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter organizations (my-team, myteam...) and press Enter to add"},allowedDomains:{label:"Allowed domains",type:"select",description:`List of comma- or space-separated domains. The user should belong to at least 
one domain to log in.`,multi:!0,allowCustomValue:!0,options:[]},authUrl:{label:"Auth URL",type:"text",description:"The authorization endpoint of your OAuth2 provider.",validation:{required:!0,validate:a=>(0,Q.K)(a),message:"This field is required and must be a valid URL."}},authStyle:{label:"Auth style",type:"select",description:"It determines how client_id and client_secret are sent to Oauth2 provider. Default is AutoDetect.",multi:!1,options:[{value:"AutoDetect",label:"AutoDetect"},{value:"InParams",label:"InParams"},{value:"InHeader",label:"InHeader"}],defaultValue:{value:"AutoDetect",label:"AutoDetect"}},tokenUrl:{label:"Token URL",type:"text",description:"The token endpoint of your OAuth2 provider.",validation:{required:!0,validate:a=>(0,Q.K)(a),message:"This field is required and must be a valid URL."}},scopes:{label:"Scopes",type:"select",description:"List of comma- or space-separated OAuth2 scopes.",multi:!0,allowCustomValue:!0,options:[]},allowedGroups:{label:"Allowed groups",type:"select",description:e.createElement(e.Fragment,null,"List of comma- or space-separated groups. The user should be a member of at least one group to log in."," ",n==="generic_oauth"&&"If you configure allowed_groups, you must also configure groups_attribute_path."),multi:!0,allowCustomValue:!0,options:[],validation:n==="azuread"?{validate:a=>typeof a=="string"?(0,fe.A)(a):j(a)?a.every(s=>s?.value&&(0,fe.A)(s.value)):!0,message:"Allowed groups must be Object Ids."}:void 0},apiUrl:{label:"API URL",type:"text",description:e.createElement(e.Fragment,null,"The user information endpoint of your OAuth2 provider. Information returned by this endpoint must be compatible with"," ",e.createElement(ge.Y,{href:"https://connect2id.com/products/server/docs/api/userinfo",external:!0,variant:"bodySmall"},"OpenID UserInfo"),"."),validation:{required:!1,validate:a=>typeof a!="string"?!1:a.length?(0,Q.K)(a):!0,message:"This field must be a valid URL if set."}},roleAttributePath:{label:"Role attribute path",description:"JMESPath expression to use for Grafana role lookup.",type:"text",validation:{required:!1}},name:{label:"Display name",description:'Will be displayed on the login page as "Sign in with ...". Helpful if you use more than one identity providers or SSO protocols.',type:"text"},allowSignUp:{label:"Allow sign up",description:"If not enabled, only existing Grafana users can log in using OAuth.",type:"switch"},autoLogin:{label:"Auto login",description:"Log in automatically, skipping the login screen.",type:"switch"},signoutRedirectUrl:{label:"Sign out redirect URL",description:"The URL to redirect the user to after signing out from Grafana.",type:"text",validation:{required:!1}},emailAttributeName:{label:"Email attribute name",description:"Name of the key to use for user email lookup within the attributes map of OAuth2 ID token.",type:"text"},emailAttributePath:{label:"Email attribute path",description:"JMESPath expression to use for user email lookup from the user information.",type:"text"},nameAttributePath:{label:"Name attribute path",description:`JMESPath expression to use for user name lookup from the user ID token. 
This name will be used as the user\u2019s display name.`,type:"text"},loginAttributePath:{label:"Login attribute path",description:"JMESPath expression to use for user login lookup from the user ID token.",type:"text"},idTokenAttributeName:{label:"ID token attribute name",description:"The name of the key used to extract the ID token from the returned OAuth2 token.",type:"text"},roleAttributeStrict:{label:"Role attribute strict mode",description:"If enabled, denies user login if the Grafana role cannot be extracted using Role attribute path.",type:"switch"},allowAssignGrafanaAdmin:{label:"Allow assign Grafana admin",description:"If enabled, it will automatically sync the Grafana server administrator role.",type:"switch",hidden:!Pe.TP.isGrafanaAdmin},skipOrgRoleSync:{label:"Skip organization role sync",description:"Prevent synchronizing users\u2019 organization roles from your IdP.",type:"switch"},defineAllowedGroups:{label:"Define allowed groups",type:"switch"},defineAllowedTeamsIds:{label:"Define allowed teams ids",type:"switch"},forceUseGraphApi:{label:"Force use Graph API",description:"If enabled, Grafana will fetch the users' groups using the Microsoft Graph API.",type:"checkbox"},usePkce:{label:"Use PKCE",description:e.createElement(e.Fragment,null,"If enabled, Grafana will use"," ",e.createElement(ge.Y,{external:!0,variant:"bodySmall",href:"https://datatracker.ietf.org/doc/html/rfc7636"},"Proof Key for Code Exchange (PKCE)")," ","with the OAuth2 Authorization Code Grant."),type:"checkbox"},useRefreshToken:{label:"Use refresh token",description:"If enabled, Grafana will fetch a new access token using the refresh token provided by the OAuth2 provider.",type:"checkbox"},tlsClientCa:{label:"TLS client ca",description:"The file path to the trusted certificate authority list. Is not applicable on Grafana Cloud.",type:"text",hidden:!ne.$.localFileSystemAvailable},tlsClientCert:{label:"TLS client cert",description:"The file path to the certificate. Is not applicable on Grafana Cloud.",type:"text",hidden:!ne.$.localFileSystemAvailable},tlsClientKey:{label:"TLS client key",description:"The file path to the key. Is not applicable on Grafana Cloud.",type:"text",hidden:!ne.$.localFileSystemAvailable},tlsSkipVerifyInsecure:{label:"TLS skip verify",description:`If enabled, the client accepts any certificate presented by the server and any host 
name in that certificate. You should only use this for testing, because this mode leaves 
SSL/TLS susceptible to man-in-the-middle attacks.`,type:"switch"},groupsAttributePath:{label:"Groups attribute path",description:`JMESPath expression to use for user group lookup. If you configure allowed_groups, 
you must also configure groups_attribute_path.`,type:"text"},teamsUrl:{label:"Teams URL",description:e.createElement(e.Fragment,null,"The URL used to query for Team Ids. If not set, the default value is /teams."," ",n==="generic_oauth"&&"If you configure teams_url, you must also configure team_ids_attribute_path."),type:"text",validation:{validate:(a,s)=>{let r=!0;return s.teamIds.length&&(r=!!a),typeof a=="string"&&a.length&&(r=(0,Q.K)(a)),r},message:"This field must be set if Team Ids are configured and must be a valid URL."}},teamIdsAttributePath:{label:"Team Ids attribute path",description:"The JMESPath expression to use for Grafana Team Id lookup within the results returned by the teams_url endpoint.",type:"text",validation:{validate:(a,s)=>s.teamIds.length?!!a:!0,message:"This field must be set if Team Ids are configured."}},teamIds:{label:"Team Ids",type:"select",description:e.createElement(e.Fragment,null,n==="github"?"Integer":"String"," list of Team Ids. If set, the user must be a member of one of the given teams to log in."," ",n==="generic_oauth"&&"If you configure team_ids, you must also configure teams_url and team_ids_attribute_path."),multi:!0,allowCustomValue:!0,options:[],placeholder:"Enter Team Ids and press Enter to add",validation:n==="github"?{validate:a=>typeof a=="string"?pe(a):j(a)?a.every(s=>s?.value&&pe(s.value)):!0,message:"Team Ids must be numbers."}:void 0},hostedDomain:{label:"Hosted domain",description:"The domain under which Grafana is hosted and accessible.",type:"text"},validateHd:{label:"Validate hosted domain",description:"If enabled, Grafana will match the Hosted Domain retrieved from the Google ID Token against the Allowed Domains list specified by the user.",type:"checkbox"}}}function pe(n){return/^-?\d+$/.test(n)}const i=({field:n,register:a,errors:s,watch:r,setValue:d,control:f,unregister:g,secretConfigured:b,provider:ee})=>{const[se,re]=(0,e.useState)(b),B=typeof n!="string",o=B?n.name:n,T=B?r(n.dependsOn):null,c=q(ee)[o],Z=(0,Ae.$j)();if((0,e.useEffect)(()=>{B&&(T||g(o))},[g,o,T,B]),!n)return console.log("missing field:",o),null;if(c.hidden||B&&!r(n.dependsOn))return null;const x={label:c.label,required:!!c.validation?.required,invalid:!!s[o],error:c.validation?.message,key:o,description:c.description,defaultValue:c.defaultValue?.value};switch(c.type){case"text":return e.createElement(u.D,{...x},e.createElement(Ee.p,{...a(o,c.validation),type:c.type,id:o,autoComplete:"off"}));case"secret":return e.createElement(u.D,{...x,htmlFor:o},e.createElement(E.xI,{name:o,control:f,rules:c.validation,render:({field:{ref:Ie,value:K,...le}})=>e.createElement(Se.L4,{...le,autoComplete:"off",id:o,value:typeof K=="string"?K:"",isConfigured:se,onReset:()=>{re(!1),d(o,"")}})}));case"select":const oe=r(o);let ie=c.options;return c.options?.length||(ie=j(oe)?oe:[]),e.createElement(u.D,{...x,htmlFor:o},e.createElement(E.xI,{rules:c.validation,name:o,control:f,render:({field:{ref:Ie,onChange:K,...le},fieldState:{invalid:Te}})=>e.createElement(Y.l6,{...le,placeholder:c.placeholder,isMulti:c.multi,invalid:Te,inputId:o,options:ie,allowCustomValue:!!c.allowCustomValue,defaultValue:c.defaultValue,onChange:K,onCreateOption:ye=>{const $={value:ye,label:ye};K([...ie||[],$])}})}));case"switch":return e.createElement(u.D,{...x},e.createElement(k.d,{...a(o),id:o}));case"checkbox":return e.createElement(Ce.S,{...a(o),id:o,...x,className:(0,ue.css)({marginBottom:Z.spacing(2)})});default:return console.error(`Unknown field type: ${c.type}`),null}},I={allowAssignGrafanaAdmin:!1,allowSignUp:!1,allowedDomains:[],allowedGroups:[],allowedOrganizations:[],apiUrl:"",authStyle:"",authUrl:"",autoLogin:!1,clientId:"",clientSecret:"",emailAttributeName:"",emailAttributePath:"",emptyScopes:!1,enabled:!1,extra:{},groupsAttributePath:"",hostedDomain:"",icon:"shield",name:"",roleAttributePath:"",roleAttributeStrict:!1,scopes:[],signoutRedirectUrl:"",skipOrgRoleSync:!1,teamIds:[],teamIdsAttributePath:"",teamsUrl:"",tlsClientCa:"",tlsClientCert:"",tlsClientKey:"",tlsSkipVerify:!1,tokenUrl:"",type:"",usePkce:!1,useRefreshToken:!1},O=n=>n?.length?Array.isArray(n)?n.map(a=>({label:a,value:a})):n.split(/[\s,]/).map(a=>({label:a,value:a})):[];function S(n){if(!n)return I;const a=F(n.provider),s=V(q(n.provider),a),r={...n.settings};for(const d of s)r[d]=O(r[d]);return r}const R=n=>n.map(({value:a})=>a).join(","),F=n=>{const a=he[n],s=["enabled"];return Object.values(a).reduce((r,d)=>[...r,...d.fields.map(f=>typeof f=="string"?f:f.name)],s)};function J(n,a){let s=n;const r=F(a),d=V(q(a),r),f=Object.keys(s).filter(g=>r.includes(g)).reduce((g,b)=>({...g,[b]:s[b]}),{});for(const g of d){const b=s[g];b&&(j(b)?f[g]=R(b):j([b])&&(f[g]=b.value))}return f}function V(n,a){return Object.entries(n).filter(([s,r])=>a.includes(s)&&r.type==="select").map(([s])=>s)}const N=(0,X.J7)(),_=({config:n,provider:a,isLoading:s})=>{const{register:r,handleSubmit:d,control:f,reset:g,watch:b,setValue:ee,unregister:se,formState:{errors:re,dirtyFields:B,isSubmitted:o}}=(0,E.mN)({defaultValues:S(n),mode:"onSubmit",reValidateMode:"onChange"}),[T,c]=(0,e.useState)(!1),[Z,x]=(0,e.useState)(!1),oe=o&&!Z,ie=he[a],[Ie,K]=(0,e.useState)(!1),le=e.createElement(l.W,null,e.createElement(l.W.Item,{label:"Reset to default values",icon:"history-alt",onClick:()=>{K(!0)}})),Te=async h=>{c(!0),x(!1);const W=J(h,a);try{await(0,w.AI)().put(`/api/v1/sso-settings/${a}`,{id:n?.id,provider:n?.provider,settings:{...W}},{showErrorAlert:!1}),(0,G.rR)("grafana_authentication_ssosettings_saved",{provider:a,enabled:W.enabled}),N.publish({type:L.r1.alertSuccess.name,payload:["Settings saved"]}),g(h),setTimeout(()=>{v.Ny.push("/admin/authentication")},300)}catch(D){let xe="";(0,w.NF)(D)?xe=D.data.message:D instanceof Error&&(xe=D.message),N.publish({type:L.r1.alertError.name,payload:[xe]}),x(!0),c(!1)}},ye=async()=>{try{await(0,w.AI)().delete(`/api/v1/sso-settings/${a}`,void 0,{showSuccessAlert:!1}),(0,G.rR)("grafana_authentication_ssosettings_removed",{provider:a}),N.publish({type:L.r1.alertSuccess.name,payload:["Settings reset to defaults"]}),setTimeout(()=>{v.Ny.push("/admin/authentication")})}catch(h){let W="";(0,w.NF)(h)?W=h.data.message:h instanceof Error&&(W=h.message),N.publish({type:L.r1.alertError.name,payload:[W]})}},$=n?.settings.enabled,Oe=h=>{(0,G.rR)("grafana_authentication_ssosettings_save_attempt",{provider:a,enabled:h?!$:$}),h&&ee("enabled",!$)};return e.createElement(H.Y.Contents,{isLoading:s},e.createElement("form",{onSubmit:d(Te),style:{maxWidth:"600px"}},e.createElement(me,{confirmRedirect:!!Object.keys(B).length&&!oe,onDiscard:()=>{(0,G.rR)("grafana_authentication_ssosettings_abandoned",{provider:a}),g()}}),e.createElement(u.D,{label:"Enabled",hidden:!0},e.createElement(k.d,{...r("enabled"),id:"enabled",label:"Enabled"})),e.createElement(C.B,{gap:2,direction:"column"},ie.filter(h=>!h.hidden).map((h,W)=>e.createElement(ae.M,{label:h.name,isOpen:W===0,key:h.name},h.fields.filter(D=>typeof D!="string"?!D.hidden:!0).map(D=>e.createElement(i,{key:typeof D=="string"?D:D.name,field:D,control:f,errors:re,setValue:ee,register:r,watch:b,unregister:se,provider:a,secretConfigured:!!n?.settings.clientSecret}))))),e.createElement(P.a,{display:"flex",gap:2,marginTop:5},e.createElement(C.B,{alignItems:"center",gap:2},e.createElement(M.$n,{type:"submit",disabled:T,onClick:()=>Oe(!0),variant:$?"secondary":void 0},T?$?"Disabling...":"Saving...":$?"Disable":"Save and enable"),e.createElement(M.$n,{type:"submit",disabled:T,variant:"secondary",onClick:()=>Oe(!1)},T?"Saving...":"Save"),e.createElement(M.z9,{href:"/admin/authentication",variant:"secondary"},"Discard"),e.createElement(ve.m,{overlay:le,placement:"bottom-start"},e.createElement(De.K,{tooltip:"More actions",title:"More actions",tooltipPlacement:"top",size:"md",variant:"secondary",name:"ellipsis-v",hidden:n?.source==="system"}))))),Ie&&e.createElement(Ue.u,{isOpen:!0,icon:"trash-alt",title:"Reset",body:e.createElement(C.B,{direction:"column",gap:3},e.createElement("span",null,"Are you sure you want to reset this configuration?"),e.createElement("small",null,"After resetting these settings Grafana will use the provider configuration from the system (config file/environment variables) if any.")),confirmText:"Reset",onDismiss:()=>K(!1),onConfirm:async()=>{await ye(),K(!1)}}))};var m=t(7250),z=t(60610);const Re=n=>{if(!n)return{text:"Authentication",subTitle:"Configure authentication providers",icon:"shield",id:"authentication"};const a=m.L[n.provider][1]||n.provider.toUpperCase();return{text:a||"",subTitle:`To configure ${a} OAuth2 you must register your application with ${a}. The provider will generate a Client ID and Client Secret for you to use.`,icon:n.settings.icon||"shield",id:n.provider}};function Le(n,a){const{isLoading:s,providers:r}=n.authConfig,{provider:d}=a.match.params;return{config:r.find(g=>g.provider===d),isLoading:s,provider:d}}const Ge={loadProviders:z.TD},ke=(0,p.connect)(Le,Ge),we=({config:n,loadProviders:a,isLoading:s,provider:r})=>{const d=Re(n);return(0,e.useEffect)(()=>{a(r)},[a,r]),n?e.createElement(H.Y,{navId:"authentication",pageNav:d,renderTitle:f=>e.createElement(C.B,{gap:2,alignItems:"center"},e.createElement(y.E,{variant:"h1"},f),e.createElement(U.E,{text:n.settings.enabled?"Enabled":"Not enabled",color:n.settings.enabled?"green":"blue",icon:n.settings.enabled?"check":void 0}))},e.createElement(_,{config:n,isLoading:s,provider:r})):null},Me=ke(we)},7250:(te,A,t)=>{t.d(A,{L:()=>p,o:()=>e});const e="admin/authentication/",p={github:["github","GitHub"],gitlab:["gitlab","GitLab"],google:["google","Google"],generic_oauth:["lock","Generic OAuth"],grafana_com:["grafana","Grafana.com"],azuread:["microsoft","Azure AD"],okta:["okta","Okta"]}},60610:(te,A,t)=>{t.d(A,{DZ:()=>G,M5:()=>L,TD:()=>X});var e=t(75505),p=t(17172),C=t(32264),y=t(10096),U=t(31678),H=t(73399),E=t(20604);function L(v=!0){return async l=>{if(y.TP.hasPermission(U.AccessControlAction.SettingsRead)){v&&l((0,E.sr)()),l(X());const u=await(0,p.AI)().get("/api/admin/settings");return l((0,E.jA)(u)),await l(w()),v&&l((0,E.MH)()),u}}}function X(v=""){return async l=>{if(!C.$.featureToggles.ssoSettingsApi)return[];const u=await(0,p.AI)().get(`/api/v1/sso-settings${v?`/${v}`:""}`);return l((0,E.Oy)(v?[u]:u)),u}}function w(){return async v=>{const l=(0,H.getRegisteredAuthProviders)(),u={},k=[];for(const P of l)k.push((0,H.getAuthProviderStatus)(P.id));const ae=await Promise.all(k);for(let P=0;P<l.length;P++){const M=l[P];u[M.id]=ae[P]}v((0,E.TO)(u))}}function G(v){return async l=>{if(y.TP.hasPermission(U.AccessControlAction.SettingsWrite))try{return await(0,e.s)((0,p.AI)().fetch({url:"/api/admin/settings",method:"PUT",data:v,showSuccessAlert:!1,showErrorAlert:!1})),l((0,E.SH)()),!0}catch(u){if(console.log(u),(0,p.NF)(u)){u.isHandled=!0;const k={message:u.data?.message,errors:u.data?.errors};return l((0,E.Nh)(k)),!1}}return!1}}},5328:(te,A,t)=>{t.d(A,{K:()=>C,h:()=>p});var e=t(7250);function p(y){return e.o+(y.configPath||y.id)}const C=y=>{if(typeof y!="string")return!1;try{return new URL(y).protocol.includes("http")}catch{return!1}}},8227:(te,A,t)=>{t.d(A,{A:()=>C});const e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function p(y){return typeof y=="string"&&e.test(y)}const C=p}}]);

//# sourceMappingURL=AdminAuthentication.eacbeb27e72d8fcbf20d.js.map